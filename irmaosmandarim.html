<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Progresso Mandarim</title>
    <!-- Inclui Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inclui PDF.js -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <style>
        /* Estilos do Checklist (Inalterados) */
        .progress-bar-bg { background-color: #e5e7eb; border-radius: 0.375rem; overflow: hidden; height: 1.25rem; border: 1px solid #d1d5db; }
        .progress-bar-fill { background-color: #34d399; height: 100%; transition: width 0.3s ease-in-out; text-align: center; color: white; font-size: 0.75rem; line-height: 1.25rem; border-radius: 0.375rem; }
        .completed-item label { text-decoration: line-through; color: #6b7280; }
        .chapter-item:hover { background-color: #f3f4f6; }
        .toggle-icon::before { content: '‚ñº '; display: inline-block; transition: transform 0.2s ease-in-out; }
        .collapsed .toggle-icon::before { transform: rotate(-90deg); content: '‚ñ∫ '; }
        /* Adiciona padding extra no body para evitar que o bot√£o do chatbase cubra conte√∫do */
        body { padding-bottom: 80px; }

        /* Estilo para a nova se√ß√£o de Notas */
        .notes-textarea {
            width: 100%;
            height: 150px; /* Altura aumentada */
            padding: 0.75rem; /* p-3 */
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            font-size: 0.875rem; /* text-sm */
            margin-top: 1rem; /* mt-4 */
            resize: vertical; /* Permite redimensionar verticalmente */
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .notes-textarea:focus {
            border-color: #3b82f6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 2px #bfdbfe; /* focus:ring-blue-200 */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans font-family-inter relative min-h-screen">

    <!-- Conte√∫do Principal do Checklist (Inalterado) -->
    <div id="app" class="container mx-auto p-4 md:p-6 max-w-3xl">
        <!-- Nova Tela Principal - Layout Dividido -->
        <div id="main-screen">
            <!-- Cabe√ßalho -->
            <div class="mb-4">
                <h1 class="text-xl md:text-2xl font-bold mb-2 text-gray-800 text-center">Meu Progresso Mandarim üìö</h1>
                <div class="bg-white p-3 rounded-lg shadow border border-gray-200">
                    <h2 class="text-md font-semibold mb-2 text-gray-700">Progresso Total</h2>
                    <div class="progress-bar-bg"><div id="progress-bar-total" class="progress-bar-fill"></div></div>
                    <p id="progress-text-total" class="text-right text-sm font-medium text-gray-600 mt-1">0%</p>
                </div>
            </div>

            <!-- Status de carregamento -->
            <div id="loading-status" class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-3 py-2 rounded mb-4">
                <p class="text-sm">üîÑ Carregando dados...</p>
            </div>
            
            <!-- Layout Principal Dividido -->
            <div class="flex flex-row gap-4" style="height: 75vh;">
                <!-- √Årea do PDF (50%) -->
                <div class="w-1/2 bg-white rounded-lg shadow border border-gray-200">
                    <div class="p-3 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-md font-semibold text-gray-700">üìñ <span id="main-pdf-info">Selecione um livro</span></h3>
                        <div class="flex gap-2">
                            <select id="book-selector" class="text-sm border border-gray-300 rounded px-2 py-1">
                                <option value="">Selecione o Livro</option>
                                <option value="0">Livro 1</option>
                                <option value="1">Livro 2</option>
                            </select>
                            <button id="prev-page-main" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">‚Äπ Ant</button>
                            <span id="page-info-main" class="text-xs text-gray-600">-</span>
                            <button id="next-page-main" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">Prox ‚Ä∫</button>
                        </div>
                    </div>
                    <div class="p-2 flex flex-col" style="height: 70vh;">
                        <canvas id="main-pdf-canvas" class="border rounded flex-1 w-full"></canvas>
                        <div id="main-pdf-loading" class="text-center py-4 text-gray-500 text-sm">
                            üìÑ Aguardando carregamento do PDF...
                        </div>
                    </div>
                </div>
                
                <!-- √Årea dos Controles (50%) -->
                <div class="w-1/2 flex flex-col">
                    <div id="books-list" class="space-y-3 flex-1 overflow-y-auto" style="height: 75vh;"></div>
                </div>
            </div>
        </div>

        <!-- Tela de Detalhes do Cap√≠tulo -->
        <div id="chapter-screen" class="hidden">
             <div class="mb-4">
                 <button id="back-button" class="text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out">&larr; Voltar</button>
                 <h1 id="chapter-title" class="text-xl md:text-2xl font-bold mb-2 text-gray-800"></h1>
                 <div class="mb-4">
                     <div class="progress-bar-bg"><div id="progress-bar-chapter-detail" class="progress-bar-fill"></div></div>
                     <p id="progress-text-chapter-detail" class="text-right text-sm font-medium text-gray-600 mt-1">0%</p>
                 </div>
             </div>
             
             <!-- Bot√µes de a√ß√£o -->
             <div class="mb-4 flex gap-2 flex-wrap">
                 <button id="show-pdf-button" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm transition">
                     üìñ <span class="hidden sm:inline">Ver</span> PDF
                 </button>
                 <button id="toggle-annotations-button" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm transition">
                     üìù <span class="hidden sm:inline">Anota√ß√µes</span>
                 </button>
                 <button id="hide-pdf-button" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded text-sm transition">
                     ‚úï <span class="hidden sm:inline">Fechar PDF</span>
                 </button>
             </div>
             
             <!-- Layout dividido: PDF + Controles -->
             <div id="split-layout" class="hidden">
                 <!-- Container flex para propor√ß√£o 70%/30% -->
                 <div class="flex flex-col lg:flex-row h-screen lg:h-auto gap-2">
                     <!-- √Årea do PDF (70% da largura) -->
                     <div id="pdf-section" class="w-full lg:w-7/10 flex-shrink-0" style="width: 70%;">
                         <div class="bg-white rounded-lg shadow border border-gray-200 h-full">
                             <div class="p-2 border-b border-gray-200 flex justify-between items-center">
                                 <h3 class="text-sm font-semibold text-gray-700">üìñ <span id="pdf-chapter-info"></span></h3>
                                 <div class="flex gap-1">
                                     <button id="prev-page" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">‚Äπ Ant</button>
                                     <span id="page-info" class="text-xs text-gray-600"></span>
                                     <button id="next-page" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">Prox ‚Ä∫</button>
                                 </div>
                             </div>
                             <div class="p-1 h-full flex flex-col">
                                 <canvas id="pdf-canvas" class="border rounded flex-1 w-full" style="max-height: 80vh; min-height: 500px;"></canvas>
                                 <div id="pdf-loading" class="text-center py-2 text-gray-500 text-sm hidden">
                                     üìÑ Carregando p√°gina...
                                 </div>
                             </div>
                         </div>
                     </div>
                     
                     <!-- √Årea dos controles (30% da largura) -->
                     <div id="controls-section" class="w-full lg:w-3/10 flex-shrink-0 flex flex-col" style="width: 30%;">
                         <!-- Painel de Anota√ß√µes -->
                         <div id="annotations-panel" class="mb-2 bg-white rounded-lg shadow border border-gray-200 flex-shrink-0">
                             <div class="p-2 border-b border-gray-200">
                                 <h3 class="text-sm font-semibold text-gray-700">üìù Anota√ß√µes do Cap√≠tulo</h3>
                             </div>
                             <div class="p-2">
                                 <textarea id="chapter-annotations" class="w-full h-16 p-2 border border-gray-300 rounded-md resize-none text-xs" 
                                           placeholder="Digite suas anota√ß√µes sobre este cap√≠tulo..."></textarea>
                                 <div class="mt-1 text-xs text-gray-500">üíæ Salvas automaticamente</div>
                             </div>
                         </div>
                         
                         <!-- Conte√∫do do checklist -->
                         <div id="chapter-content-split" class="bg-white rounded-lg shadow border border-gray-200 flex-1 overflow-y-auto">
                             <div class="p-2 border-b border-gray-200">
                                 <h3 class="text-sm font-semibold text-gray-700">üìã Checklist do Cap√≠tulo</h3>
                             </div>
                             <div class="p-2 space-y-2">
                                 <!-- Conte√∫do ser√° gerado aqui -->
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
             
             <!-- Layout tradicional (quando PDF n√£o est√° vis√≠vel) -->
             <div id="traditional-layout">
                 <div id="chapter-content" class="bg-white p-4 rounded-lg shadow space-y-4 border border-gray-200">
                     <!-- Conte√∫do do checklist √© gerado aqui -->
                 </div>
             </div>
        </div>
    </div>

    <!-- Script Principal do Checklist -->
    <script>
        console.log('üöÄ C√ìDIGO JAVASCRIPT CARREGADO - VERS√ÉO COM LAYOUT DIVIDIDO - REDEPLOY');
        console.log('üïê Timestamp:', new Date().toISOString());
        console.log('üìÖ Deploy for√ßado:', 'Force cache bust');
        
        // --- Mapeamento de P√°ginas dos Cap√≠tulos ---
        const chapterPageMapping = {
            0: { // Livro 1
                0: { startPage: 1, endPage: 15 },    // Introdu√ß√£o
                1: { startPage: 16, endPage: 30 },   // ‰Ω†ÊòØÂ∑¥Ë•ø‰∫∫Âêó?
                2: { startPage: 31, endPage: 45 },   // ‰Ω†Êúâ‰π¶Âêó?
                3: { startPage: 46, endPage: 60 },   // ‰ªñ‰ª¨ÊòØË∞Å?
                4: { startPage: 61, endPage: 75 },   // ‰Ω†Â≠¶‰π†Ê±âËØ≠Âêó?
                5: { startPage: 76, endPage: 90 },   // ‰ªäÂ§©Âá†ÊúàÂá†Âè∑?
                6: { startPage: 91, endPage: 105 },  // ‰Ω†Âá†ÁÇπËµ∑Â∫ä?
                7: { startPage: 106, endPage: 120 }, // ËØ∑ÈóÆ,Â≠¶Ê†°Âú®Âì™Èáå?
                8: { startPage: 121, endPage: 135 }  // ‰Ω†ÁöÑÊàøÈó¥ÈáåÊúâ‰ªÄ‰πà?
            },
            1: { // Livro 2  
                9: { startPage: 1, endPage: 15 },    // ‰Ω†ÊÉ≥Âñù‰ªÄ‰πà?
                10: { startPage: 16, endPage: 30 },  // Ëøô‰∏™Â§öÂ∞ëÈí±?
                11: { startPage: 31, endPage: 45 },  // ÊàëÂéª‰π∞‰∏úË•ø
                12: { startPage: 46, endPage: 60 },  // Êàë‰ª¨ÊÄé‰πàÂéª‰ªñÁöÑÂÆ∂?
                13: { startPage: 61, endPage: 75 },  // ÊàëË∑üÊúãÂèã‰∏ÄËµ∑ÂêÉÂçàÈ•≠
                14: { startPage: 76, endPage: 90 },  // Â•π‰∏çËÉΩÂéª,Â•πË¶Å‰ºëÊÅØ
                15: { startPage: 91, endPage: 105 }, // ‰ªéËøôÈáåÂà∞ÈïøÂüéÊÄé‰πàÂéª?
                16: { startPage: 106, endPage: 120 } // ‰Ω†Âú®ÂÅö‰ªÄ‰πàÂë¢?
            }
        };

        // --- Estrutura de Dados do Checklist (Inalterada) ---
        const checklistData = [
            // ... (toda a estrutura de dados completa, como na vers√£o anterior) ...
             {
            livro: 1,
            tituloLivro: "Livro 1",
            capitulos: [
              {
                capitulo: 0,
                tituloCapitulo: "Introdu√ß√£o",
                subtopicos: {
                  topicos: [
                    { id: "l1c0t1", texto: "Introdu√ß√£o ao Pinyin (Iniciais, Finais, Tons)", concluido: false },
                    { id: "l1c0t2", texto: "Regras de pron√∫ncia e mudan√ßas de tom", concluido: false },
                    { id: "l1c0t3", texto: "Estrutura b√°sica dos caracteres chineses (Hanzi)", concluido: false },
                    { id: "l1c0t4", texto: "Ordem dos tra√ßos", concluido: false },
                  ]
                }
              },
              {
                capitulo: 1,
                tituloCapitulo: "‰Ω†ÊòØÂ∑¥Ë•ø‰∫∫Âêó?",
                subtopicos: {
                  dialogos: [
                    { id: "l1c1d1", texto: "Di√°logo 1 (Paulo e Xiaolong se conhecem)", concluido: false },
                    { id: "l1c1d2", texto: "Di√°logo 2 (Professora Li e Lia)", concluido: false },
                    { id: "l1c1d3", texto: "Apresenta√ß√£o (Thiago e Lucas)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c1v1", texto: "Vocabul√°rio 1: Cumprimentos (‰Ω†Â•Ω), pronomes (‰Ω†, Êàë), chamar-se (Âè´), ser (ÊòØ), nacionalidades (‰∏≠ÂõΩ‰∫∫, Â∑¥Ë•ø‰∫∫), pergunta (Âêó), n√£o (‰∏ç), tamb√©m (‰πü)", concluido: false },
                    { id: "l1c1v2", texto: "Vocabul√°rio 2: Tratamento formal (ÊÇ®), profiss√µes (ËÄÅÂ∏à, Â≠¶Áîü), pa√≠ses (ÁæéÂõΩ, Ëã±ÂõΩ), pronomes (‰ªñ, Â•π, ‰ª¨)", concluido: false },
                    { id: "l1c1v3", texto: "Vocabul√°rio 3: Taiwan (Âè∞Êπæ), agradecer (Ë∞¢Ë∞¢)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c1g1", texto: "Estrutura b√°sica da frase", concluido: false },
                    { id: "l1c1g2", texto: "Uso do verbo ÊòØ (ser)", concluido: false },
                    { id: "l1c1g3", texto: "Formando perguntas com Âêó", concluido: false },
                    { id: "l1c1g4", texto: "Nega√ß√£o com ‰∏ç", concluido: false },
                    { id: "l1c1g5", texto: "Uso do adv√©rbio ‰πü (tamb√©m)", concluido: false },
                    { id: "l1c1g6", texto: "Pronomes e plural com ‰ª¨", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c1e1", texto: "Exerc√≠cio: Completar frases com ÊòØ", concluido: false },
                    { id: "l1c1e2", texto: "Exerc√≠cio: Formular perguntas com Âêó", concluido: false },
                    { id: "l1c1e3", texto: "Exerc√≠cio: Transformar frases (afirma√ß√£o, nega√ß√£o, pergunta)", concluido: false },
                    { id: "l1c1e4", texto: "Exerc√≠cio: Completar di√°logo", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c1h1", texto: "Pr√°tica de Hanzi: ‰Ω†, Â•Ω, Êàë, Âè´, ÊòØ, ‰∏≠, ÂõΩ, ‰∫∫, Âêó, ‰πü, ‰∏ç, Â∑¥, Ë•ø, Â≠¶, Áîü, ËÄÅ, Â∏à, ÊÇ®, Áæé, Ëã±, ‰ªñ, Â•π, ‰ª¨, Âè∞, Êπæ, Ë∞¢", concluido: false }
                  ]
                }
              },
               {
                capitulo: 2,
                tituloCapitulo: "‰Ω†Êúâ‰π¶Âêó?",
                subtopicos: {
                  dialogos: [
                    { id: "l1c2d1", texto: "Di√°logo 1 (Professora Li e Paulo - materiais)", concluido: false },
                    { id: "l1c2d2", texto: "Di√°logo 2 (Paulo mostra a casa para Lia)", concluido: false },
                    { id: "l1c2d3", texto: "Texto (Professora Li descreve sua casa)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c2v1", texto: "Vocabul√°rio 1: Ter (Êúâ), n√£o ter (Ê≤íÊúâ), objetos (‰π¶, Á¨î, ÈìÖÁ¨î, Âú∞Âõæ)", concluido: false },
                    { id: "l1c2v2", texto: "Vocabul√°rio 2: Este/Isto (Ëøô), posse (ÁöÑ), casa/fam√≠lia (ÂÆ∂), bem-vindo (Ê¨¢Ëøé), TV (ÁîµËßÜ), computador (ÁîµËÑë), um (‰∏Ä), medida geral (‰∏™)", concluido: false },
                    { id: "l1c2v3", texto: "Vocabul√°rio 3: Dois (‰∏§/‰∫å), 3-5 (‰∏â, Âõõ, ‰∫î), medidas (ÊîØ, Êú¨, Âº†)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c2g1", texto: "Uso do verbo Êúâ / Ê≤°Êúâ", concluido: false },
                    { id: "l1c2g2", texto: "Part√≠cula de posse ÁöÑ", concluido: false },
                    { id: "l1c2g3", texto: "Uso de palavras de medida com numerais", concluido: false },
                    { id: "l1c2g4", texto: "Diferen√ßa entre ‰∏§ e ‰∫å", concluido: false }
                  ],
                   exercicios: [
                    { id: "l1c2e1", texto: "Exerc√≠cio: Responder perguntas usando ÁöÑ", concluido: false },
                    { id: "l1c2e2", texto: "Exerc√≠cio: Responder perguntas usando Êúâ/Ê≤°Êúâ", concluido: false },
                    { id: "l1c2e3", texto: "Exerc√≠cio: Ligar palavras e imagens", concluido: false },
                    { id: "l1c2e4", texto: "Exerc√≠cio: Preencher com palavras de medida", concluido: false },
                    { id: "l1c2e5", texto: "Exerc√≠cio: Transformar frases", concluido: false },
                    { id: "l1c2e6", texto: "Exerc√≠cio: Reorganizar palavras", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c2h1", texto: "Pr√°tica de Hanzi: Êúâ, Ê≤°, ‰π¶, Á¨î, ÈìÖ, Âú∞, Âõæ, Ê¨¢, Ëøé, Ëøô, ÁöÑ, ÂÆ∂, Áîµ, ËßÜ, ËÑë, ‰∏Ä, ‰∏™, ‰∏§, ‰∫å, ‰∏â, ÊîØ, Âõõ, ‰∫î, Êú¨, Âº†", concluido: false }
                  ]
                }
              },
               {
                capitulo: 3,
                tituloCapitulo: "‰ªñ‰ª¨ÊòØË∞Å?",
                 subtopicos: {
                  dialogos: [
                    { id: "l1c3d1", texto: "Di√°logo 1 (Xiaolong mostra foto de fam√≠lia)", concluido: false },
                    { id: "l1c3d2", texto: "Di√°logo 2 (Lia e Marina falam sobre fam√≠lias)", concluido: false },
                    { id: "l1c3d3", texto: "Di√°logo 3 (Professora Li pergunta sobre fam√≠lias)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c3v1", texto: "Vocabul√°rio 1: Foto (ÁÖßÁâá), sim (ÊòØÁöÑ), quem? (Ë∞Å), fam√≠lia (ÂÆ∂‰∫∫), quantos? (Âá†), medida (Âè£), pai (Áà∏Áà∏), m√£e (Â¶àÂ¶à), e (Âíå)", concluido: false },
                    { id: "l1c3v2", texto: "Vocabul√°rio 2: O qu√™? (‰ªÄ‰πà), m√©dico (ÂåªÁîü), irm√£o mais velho (Âì•Âì•), fazer (ÂÅö), trabalho (Â∑•‰Ωú), irm√£ mais velha (ÂßêÂßê), irm√£ mais nova (Â¶πÂ¶π)", concluido: false },
                    { id: "l1c3v3", texto: "Vocabul√°rio 3: Irm√£o mais novo (ÂºüÂºü)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c3g1", texto: "Perguntar 'quem?' com Ë∞Å", concluido: false },
                    { id: "l1c3g2", texto: "Perguntar 'quantos?' (poucos) com Âá†", concluido: false },
                    { id: "l1c3g3", texto: "Perguntar 'o qu√™?' com ‰ªÄ‰πà", concluido: false },
                    { id: "l1c3g4", texto: "Uso da medida Âè£ para fam√≠lia", concluido: false },
                    { id: "l1c3g5", texto: "Perguntar a profiss√£o (ÂÅö‰ªÄ‰πàÂ∑•‰Ωú)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c3e1", texto: "Exerc√≠cio: Formular perguntas com ‰ªÄ‰πà, Âá†, Ë∞Å", concluido: false },
                    { id: "l1c3e2", texto: "Exerc√≠cio: Responder perguntas pessoais", concluido: false },
                    { id: "l1c3e3", texto: "Exerc√≠cio: Leitura e interpreta√ß√£o", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c3h1", texto: "Pr√°tica de Hanzi: ÁÖß, Áâá, ÊòØ, ÁöÑ, Ë∞Å, ÂÆ∂, ‰∫∫, Âá†, Âè£, Áà∏, Â¶à, Âíå, ‰ªÄ, ‰πà, Âåª, Áîü, Âì•, ÂÅö, Â∑•, ‰Ωú, Âßê, Â¶π, Âºü", concluido: false }
                  ]
                }
              },
              {
                capitulo: 4,
                tituloCapitulo: "‰Ω†Â≠¶‰π†Ê±âËØ≠Âêó?",
                subtopicos: {
                   dialogos: [
                    { id: "l1c4d1", texto: "Di√°logo 1 (Marina e Xiaolong - nacionalidade, estudos)", concluido: false },
                    { id: "l1c4d2", texto: "Di√°logo 2 (Lia e Paulo - turmas)", concluido: false },
                    { id: "l1c4d3", texto: "Di√°logo 3 (Marina recebe Lia e Paulo)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l1c4v1", texto: "Vocabul√°rio 1: Nome (ÂêçÂ≠ó), qual? (Âì™), pa√≠s (ÂõΩ), estudar (Â≠¶‰π†/Â≠¶), Mandarim (Ê±âËØ≠), correto (ÂØπ), Ingl√™s (Ëã±ËØ≠), Portugu√™s (Ëë°ËêÑÁâôËØ≠), dif√≠cil (Èöæ)", concluido: false },
                    { id: "l1c4v2", texto: "Vocabul√°rio 2: Turma (Áè≠), todos (ÈÉΩ), estrangeiro (Â§ñÂõΩ/Â§ñÂõΩ‰∫∫), quantos? (Â§öÂ∞ë), menino/aluno (Áî∑Áîü), menina/aluna (Â•≥Áîü), 6-10 (ÂÖ≠, ‰∏É, ÂÖ´, ‰πù, ÂçÅ)", concluido: false },
                    { id: "l1c4v3", texto: "Vocabul√°rio 3: Amigo (ÊúãÂèã), colega (ÂêåÂ≠¶)", concluido: false }
                  ],
                   gramatica: [
                    { id: "l1c4g1", texto: "Perguntar 'qual pa√≠s?' com Âì™ÂõΩ", concluido: false },
                    { id: "l1c4g2", texto: "Uso de Â§öÂ∞ë vs Âá†", concluido: false },
                    { id: "l1c4g3", texto: "Uso do adv√©rbio ÈÉΩ (todos)", concluido: false },
                    { id: "l1c4g4", texto: "Estrutura ‰∏çÈÉΩ (nem todos)", concluido: false },
                    { id: "l1c4g5", texto: "Forma√ß√£o de n√∫meros 11-99", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c4e1", texto: "Exerc√≠cio: Ouvir e escrever n√∫meros", concluido: false },
                    { id: "l1c4e2", texto: "Exerc√≠cio: Interpreta√ß√£o de texto (alunos)", concluido: false },
                    { id: "l1c4e3", texto: "Exerc√≠cio: Escrever n√∫meros em caracteres", concluido: false },
                    { id: "l1c4e4", texto: "Exerc√≠cio: Fazer perguntas com Âá† / Â§öÂ∞ë", concluido: false },
                    { id: "l1c4e5", texto: "Exerc√≠cio: Responder perguntas pessoais", concluido: false }
                  ],
                   hanzi: [
                    { id: "l1c4h1", texto: "Pr√°tica de Hanzi: Âêç, Â≠ó, Âì™, ÂõΩ, Â≠¶, ‰π†, Ê±â, ËØ≠, ÂØπ, Ëã±, Ëë°, ËêÑ, Áâô, Èöæ, Áè≠, ÈÉΩ, Â§ñ, Â§ö, Â∞ë, Áî∑, Â•≥, Áîü, ÂÖ≠, ‰∏É, ÂÖ´, ‰πù, ÂçÅ, Êúã, Âèã, Âêå", concluido: false }
                  ]
                }
              },
               {
                capitulo: 5,
                tituloCapitulo: "‰ªäÂ§©Âá†ÊúàÂá†Âè∑?",
                subtopicos: {
                   dialogos: [
                    { id: "l1c5d1", texto: "Di√°logo 1 (Lia parabeniza Marina)", concluido: false },
                    { id: "l1c5d2", texto: "Di√°logo 2 (Paulo e Xiaolong - anivers√°rios)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l1c5v1", texto: "Vocabul√°rio 1: Al√¥ (ÂñÇ), muito (Âæà), hoje (‰ªäÂ§©), dia (Â§©), anivers√°rio (ÁîüÊó•), desejar (Á•ù), feliz (Âø´‰πê), de nada (‰∏çË∞¢), amanh√£ (ÊòéÂ§©), ontem (Êò®Â§©), dar presente (ÈÄÅ), presente (Á§ºÁâ©), feliz/contente (È´òÂÖ¥)", concluido: false },
                    { id: "l1c5v2", texto: "Vocabul√°rio 2: M√™s (Êúà), dia (Âè∑/Êó•), semana (ÊòüÊúü/Á§ºÊãú), dias da semana (ÊòüÊúü‰∏Ä a Êó•), idade (Â≤Å)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c5g1", texto: "Formular datas (M√™s + Dia)", concluido: false },
                    { id: "l1c5g2", texto: "Perguntar data (Âá†ÊúàÂá†Âè∑)", concluido: false },
                    { id: "l1c5g3", texto: "Perguntar dia da semana (ÊòüÊúüÂá†)", concluido: false },
                    { id: "l1c5g4", texto: "Perguntar idade (Âá†Â≤Å)", concluido: false },
                    { id: "l1c5g5", texto: "Expressar votos (Á•ù‰Ω†ÁîüÊó•Âø´‰πê)", concluido: false }
                  ],
                  exercicios: [
                     { id: "l1c5e1", texto: "Exerc√≠cio: Responder perguntas (datas, dias da semana)", concluido: false },
                     { id: "l1c5e2", texto: "Exerc√≠cio: Responder perguntas (anivers√°rios, idade)", concluido: false },
                     { id: "l1c5e3", texto: "Exerc√≠cio: Completar di√°logo (anivers√°rio)", concluido: false }
                  ],
                  hanzi: [
                     { id: "l1c5h1", texto: "Pr√°tica de Hanzi: ÂñÇ, Âæà, ‰ªä, Â§©, Áîü, Êó•, Á•ù, Âø´, ‰πê, ‰∏ç, Ë∞¢, Êòé, ÈÄÅ, Á§º, Áâ©, È´ò, ÂÖ¥, Êúà, Âè∑, Êòü, Êúü, Â≤Å, ‰∏Ä, ‰∫å, ‰∏â, Âõõ, ‰∫î, ÂÖ≠", concluido: false }
                  ]
                }
              },
              {
                capitulo: 6,
                tituloCapitulo: "‰Ω†Âá†ÁÇπËµ∑Â∫ä?",
                 subtopicos: {
                   dialogos: [
                    { id: "l1c6d1", texto: "Di√°logo 1 (Xiaolong pergunta horas ao pai)", concluido: false },
                    { id: "l1c6d2", texto: "Di√°logo 2 (Professora Li e Marina - rotina)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l1c6v1", texto: "Vocabul√°rio 1: Agora (Áé∞Âú®), hora (ÁÇπ), zero (Èõ∂), minuto (ÂàÜ), por qu√™? (‰∏∫‰ªÄ‰πà), manh√£ cedo (Êó©‰∏ä), metade/meia (Âçä), come√ßar/terminar aula (‰∏äËØæ/‰∏ãËØæ), de manh√£ (‰∏äÂçà), quarto de hora (Âàª)", concluido: false },
                    { id: "l1c6v2", texto: "Vocabul√°rio 2: Acordar (Ëµ∑Â∫ä), momento (Êó∂ÂÄô), quando? (‰ªÄ‰πàÊó∂ÂÄô), meio-dia (‰∏≠Âçà), √† tarde (‰∏ãÂçà), ver/assistir/ler (Áúã/Áúã‰π¶), √† noite (Êôö‰∏ä), dormir (Áù°Ëßâ)", concluido: false }
                  ],
                  gramatica: [
                     { id: "l1c6g1", texto: "Expressar horas e minutos", concluido: false },
                     { id: "l1c6g2", texto: "Uso de Âçä (meia hora) e Âàª (quarto de hora)", concluido: false },
                     { id: "l1c6g3", texto: "Perguntar horas (Âá†ÁÇπ)", concluido: false },
                     { id: "l1c6g4", texto: "Perguntar 'quando?' (‰ªÄ‰πàÊó∂ÂÄô)", concluido: false },
                     { id: "l1c6g5", texto: "Divis√µes do dia (Êó©‰∏ä, ‰∏äÂçà, ‰∏≠Âçà, ‰∏ãÂçà, Êôö‰∏ä)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c6e1", texto: "Exerc√≠cio: Dizer as horas", concluido: false },
                    { id: "l1c6e2", texto: "Exerc√≠cio: Responder perguntas (rotina, hor√°rios)", concluido: false },
                    { id: "l1c6e3", texto: "Exerc√≠cio: Ouvir e ordenar hor√°rios", concluido: false },
                    { id: "l1c6e4", texto: "Exerc√≠cio: Completar di√°logo (horas)", concluido: false }
                  ],
                  hanzi: [
                     { id: "l1c6h1", texto: "Pr√°tica de Hanzi: Áé∞, Âú®, ÁÇπ, Èõ∂, ÂàÜ, ‰∏∫, ‰ªÄ, ‰πà, Êó©, ‰∏ä, Âçä, ËØæ, ‰∏ã, Âçà, Âàª, Ëµ∑, Â∫ä, Êó∂, ÂÄô, ‰∏≠, Áúã, ‰π¶, Êôö, Áù°, Ëßâ", concluido: false }
                  ]
                 }
              },
               {
                capitulo: 7,
                tituloCapitulo: "ËØ∑ÈóÆ,Â≠¶Ê†°Âú®Âì™Èáå?",
                 subtopicos: {
                   dialogos: [
                    { id: "l1c7d1", texto: "Di√°logo 1 (Lia indica caminho da escola)", concluido: false },
                    { id: "l1c7d2", texto: "Di√°logo 2 (Paulo pede informa√ß√£o a policial)", concluido: false },
                    { id: "l1c7d3", texto: "Apresenta√ß√£o (Yaoming descreve arredores)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c7v1", texto: "Vocabul√°rio 1: Escola (Â≠¶Ê†°), estar em (Âú®), onde? (Âì™Èáå), frente (ÂâçÈù¢/ÂâçËæπ), com fome (È•ø), ao lado (ÊóÅËæπ), restaurante (È•≠È¶Ü), atr√°s (ÂêéÈù¢/ÂêéËæπ), banco (Èì∂Ë°å), oeste (Ë•øËæπ), leste (‰∏úËæπ)", concluido: false },
                    { id: "l1c7v2", texto: "Vocabul√°rio 2: Com licen√ßa (ËØ∑ÈóÆ), aquele (ÈÇ£), lugar (Âú∞Êñπ), medida pr√©dios (Â∫ß), pr√©dio (Ê•º), hospital (ÂåªÈô¢), norte (ÂåóËæπ), sul (ÂçóËæπ), livraria (‰π¶Â∫ó), loja (Â∫ó), de nada (‰∏çÂÆ¢Ê∞î)", concluido: false },
                    { id: "l1c7v3", texto: "Vocabul√°rio 3: Conhecer (ËÆ§ËØÜ)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c7g1", texto: "Uso de Âú® para localiza√ß√£o", concluido: false },
                    { id: "l1c7g2", texto: "Perguntar 'onde?' com Âú®Âì™Èáå", concluido: false },
                    { id: "l1c7g3", texto: "Palavras de localiza√ß√£o (pontos cardeais, posi√ß√µes)", concluido: false },
                    { id: "l1c7g4", texto: "Uso de ËØ∑ÈóÆ", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c7e1", texto: "Exerc√≠cio: Descrever localiza√ß√µes (imagens)", concluido: false },
                    { id: "l1c7e2", texto: "Exerc√≠cio: Responder perguntas (dire√ß√µes)", concluido: false },
                    { id: "l1c7e3", texto: "Exerc√≠cio: Responder perguntas (localiza√ß√£o)", concluido: false },
                    { id: "l1c7e4", texto: "Exerc√≠cio: Fazer perguntas (interrogativos)", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c7h1", texto: "Pr√°tica de Hanzi: Â≠¶, Ê†°, Âú®, Âì™, Èáå, Ââç, Ëæπ, Èù¢, È•ø, ÊóÅ, È•≠, È¶Ü, Âêé, Èì∂, Ë°å, Ë•ø, ‰∏ú, ËØ∑, ÈóÆ, ÈÇ£, ‰∏™, Âú∞, Êñπ, Â∫ß, Ê•º, Âåª, Èô¢, Âåó, Âçó, ‰π¶, Â∫ó, ‰∏ç, ÂÆ¢, Ê∞î, ËÆ§, ËØÜ", concluido: false }
                  ]
                }
              },
               {
                capitulo: 8,
                tituloCapitulo: "‰Ω†ÁöÑÊàøÈó¥ÈáåÊúâ‰ªÄ‰πà?",
                 subtopicos: {
                   dialogos: [
                    { id: "l1c8d1", texto: "Di√°logo 1 (Yaoming visita quarto de Lia)", concluido: false },
                    { id: "l1c8d2", texto: "Di√°logo 2 (Xiaolong visita quarto de Paulo - animais)", concluido: false },
                    { id: "l1c8d3", texto: "Texto (Professora Li descreve seu quarto)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c8v1", texto: "Vocabul√°rio 1: Bonito (ÊºÇ‰∫Æ), quarto (ÊàøÈó¥), dentro (Èáå/ÈáåËæπ), mesa (Ê°åÂ≠ê), cama (Â∫ä), medida (Êää), cadeira (Ê§ÖÂ≠ê), estante (‰π¶Êû∂), fora (Â§ñ/Â§ñËæπ)", concluido: false },
                    { id: "l1c8v2", texto: "Vocabul√°rio 2: Esquerda (Â∑¶/Â∑¶Ëæπ), direita (Âè≥/Âè≥Ëæπ), medida (Âè™), cachorro (Áãó), gato (Áå´), cima (‰∏ä/‰∏äËæπ), part√≠cula (Âë¢), baixo (‰∏ã/‰∏ãËæπ)", concluido: false },
                    { id: "l1c8v3", texto: "Vocabul√°rio 3: Meio/Entre (‰∏≠Èó¥)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c8g1", texto: "Palavras de localiza√ß√£o detalhadas", concluido: false },
                    { id: "l1c8g2", texto: "Estrutura 'Local + Verbo + Objeto'", concluido: false },
                    { id: "l1c8g3", texto: "Uso da part√≠cula Âë¢ (retomar pergunta)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c8e1", texto: "Exerc√≠cio: Responder perguntas (pr√≥prio quarto)", concluido: false },
                    { id: "l1c8e2", texto: "Exerc√≠cio: Descrever localiza√ß√µes (imagens)", concluido: false },
                    { id: "l1c8e3", texto: "Exerc√≠cio: Preencher com palavras de medida", concluido: false },
                    { id: "l1c8e4", texto: "Exerc√≠cio: Reorganizar palavras", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c8h1", texto: "Pr√°tica de Hanzi: ÊºÇ, ‰∫Æ, Êàø, Èó¥, Èáå, Ëæπ, Ê°å, Â≠ê, Â∫ä, Êää, Ê§Ö, ‰π¶, Êû∂, Â§ñ, Â∑¶, Âè≥, Âè™, Áãó, Áå´, ‰∏ä, Âë¢, ‰∏ã, ‰∏≠", concluido: false }
                  ]
                 }
              }
            ]
          },
          {
            livro: 2,
            tituloLivro: "Livro 2",
            capitulos: [
              {
                capitulo: 9,
                tituloCapitulo: "‰Ω†ÊÉ≥Âñù‰ªÄ‰πà?",
                 subtopicos: {
                   dialogos: [
                    { id: "l2c9d1", texto: "Di√°logo 1 (Marina oferece bebida a Lia)", concluido: false },
                    { id: "l2c9d2", texto: "Di√°logo 2 (Paulo no restaurante chin√™s)", concluido: false },
                    { id: "l2c9d3", texto: "Di√°logo 3 (Xiaolong convida Marina)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l2c9v1", texto: "Vocabul√°rio 1: Â•Ω‰πÖ‰∏çËßÅ, Âùê, ÊÉ≥, Âñù, ÂíñÂï°, ËøòÊòØ, Ëå∂, Ê∞¥, Ë°å", concluido: false },
                    { id: "l2c9v2", texto: "Vocabul√°rio 2: ‰Ωç, ÂêÉ, Êä´Ëê®, ËøôÈáå, Ëèú, ÁÇíÈù¢, Á±≥È•≠, È•∫Â≠ê, ÂåÖÂ≠ê", concluido: false },
                    { id: "l2c9v3", texto: "Vocabul√°rio 3: Âï§ÈÖí, Âêß, ÂØπ‰∏çËµ∑, ‰∏çË°å", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c9g1", texto: "Uso de ÊÉ≥ (gostaria)", concluido: false },
                    { id: "l2c9g2", texto: "Perguntas com ËøòÊòØ (ou)", concluido: false },
                    { id: "l2c9g3", texto: "Perguntas afirmativo-negativas", concluido: false },
                    { id: "l2c9g4", texto: "Uso da part√≠cula Âêß (sugest√£o)", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c9e1", texto: "Exerc√≠cio: Formular perguntas com ËøòÊòØ", concluido: false },
                    { id: "l2c9e2", texto: "Exerc√≠cio: Criar perguntas afirmativo-negativas", concluido: false },
                    { id: "l2c9e3", texto: "Exerc√≠cio: Reformular perguntas (...Âêó? -> afirm-neg)", concluido: false },
                    { id: "l2c9e4", texto: "Exerc√≠cio: Reformular perguntas (...‰ªÄ‰πà? -> ...ËøòÊòØ...)", concluido: false }
                  ],
                   hanzi: [
                    { id: "l2c9h1", texto: "Pr√°tica de Hanzi: Â•Ω, ‰πÖ, ‰∏ç, ËßÅ, Âùê, ÊÉ≥, Âñù, Âíñ, Âï°, Ëøò, ÊòØ, Ëå∂, Ê∞¥, Ë°å, ‰Ωç, ÂêÉ, Êä´, Ëê®, Ëøô, Èáå, Ëèú, ÁÇí, Èù¢, Á±≥, È•≠, È•∫, Â≠ê, ÂåÖ, Âï§, ÈÖí, Âêß, ÂØπ, Ëµ∑", concluido: false }
                  ]
                }
              },
               {
                capitulo: 10,
                tituloCapitulo: "Ëøô‰∏™Â§öÂ∞ëÈí±?",
                 subtopicos: {
                  dialogos: [
                    { id: "l2c10d1", texto: "Di√°logo 1 (Lia compra frutas)", concluido: false },
                    { id: "l2c10d2", texto: "Di√°logo 2 (Paulo compra lanche)", concluido: false },
                    { id: "l2c10d3", texto: "Di√°logo 3 (Xiaolong pechincha)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l2c10v1", texto: "Vocabul√°rio 1: Ë¶Å, ‰π∞, Êñ§, ÂÖ¨Êñ§, ËãπÊûú, È¶ôËïâ, Áßç, Èí±, Â§öÂ∞ëÈí±, Âùó/ÂÖÉ, ÊØõ/Ëßí, ÂàÜ", concluido: false },
                    { id: "l2c10v2", texto: "Vocabul√°rio 2: ÊùØ, Â§ß, Â∞è, Ëøò, Âà´ÁöÑ, ‰∏ÄÂÖ±, Áªô, Êâæ", concluido: false },
                    { id: "l2c10v3", texto: "Vocabul√°rio 3: Â§™...‰∫Ü, Ë¥µ, ‰æøÂÆú, ‰∏ÄÁÇπ, ÊÄé‰πàÊ†∑", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c10g1", texto: "Perguntar pre√ßo (Â§öÂ∞ëÈí±)", concluido: false },
                    { id: "l2c10g2", texto: "Estrutura Â§™ + Adj + ‰∫Ü", concluido: false },
                    { id: "l2c10g3", texto: "Express√µes para pechinchar", concluido: false },
                    { id: "l2c10g4", texto: "Uso de Ëøò (ainda/al√©m disso)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c10e1", texto: "Exerc√≠cio: Escrever pre√ßos", concluido: false },
                    { id: "l2c10e2", texto: "Exerc√≠cio: Calcular pre√ßos", concluido: false },
                    { id: "l2c10e3", texto: "Exerc√≠cio: Responder perguntas (pre√ßos)", concluido: false },
                    { id: "l2c10e4", texto: "Exerc√≠cio: Completar frases (compras)", concluido: false }
                  ],
                  hanzi: [
                     { id: "l2c10h1", texto: "Pr√°tica de Hanzi: Ë¶Å, ‰π∞, Êñ§, ÂÖ¨, Ëãπ, Êûú, È¶ô, Ëïâ, Áßç, Èí±, Â§ö, Â∞ë, Âùó, ÂÖÉ, ÊØõ, Ëßí, ÂàÜ, ÊùØ, Â§ß, Â∞è, Ëøò, Âà´, ÁöÑ, ‰∏Ä, ÂÖ±, Áªô, Êâæ, Â§™, ‰∫Ü, Ë¥µ, ‰æø, ÂÆú, ÁÇπ, ÊÄé, ‰πà, Ê†∑", concluido: false }
                  ]
                }
              },
              {
                capitulo: 11,
                tituloCapitulo: "ÊàëÂéª‰π∞‰∏úË•ø",
                 subtopicos: {
                   dialogos: [
                    { id: "l2c11d1", texto: "Di√°logo 1 (Yaoming e Paulo combinam supermercado)", concluido: false },
                    { id: "l2c11d2", texto: "Di√°logo 2 (Lia e Marina ap√≥s aula)", concluido: false },
                    { id: "l2c11d3", texto: "Di√°logo 3 (Marina troca dinheiro)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c11v1", texto: "Vocabul√°rio 1: Âøô, ÊúâÁ©∫, Âéª, Ë∂ÖÂ∏Ç, ‰∏úË•ø, ‰Ωè, Ëøò, ÁîµËØù, Âè∑Á†Å, ÂÜçËßÅ", concluido: false },
                    { id: "l2c11v2", texto: "Vocabul√°rio 2: Âõû, Êç¢, Êç¢Èí±, Êù•, Áé©", concluido: false },
                    { id: "l2c11v3", texto: "Vocabul√°rio 3: ÁæéÂÖÉ, Ê¨ßÂÖÉ, ‰∫∫Ê∞ëÂ∏Å, Â∑¥Â∏Å, Áôæ, ÂçÉ, ‰∏á", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c11g1", texto: "Verbos de dire√ß√£o Âéª, Êù•, Âõû", concluido: false },
                    { id: "l2c11g2", texto: "Estrutura Verbo1 + Local + Verbo2", concluido: false },
                    { id: "l2c11g3", texto: "N√∫meros grandes (centenas, milhares...)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c11e1", texto: "Exerc√≠cio: Formular frases (Verbo1+Local+Verbo2)", concluido: false },
                    { id: "l2c11e2", texto: "Exerc√≠cio: Ligar Hanzi", concluido: false },
                    { id: "l2c11e3", texto: "Exerc√≠cio: Escrever n√∫meros grandes", concluido: false },
                    { id: "l2c11e4", texto: "Exerc√≠cio: Responder perguntas (rotina)", concluido: false },
                    { id: "l2c11e5", texto: "Exerc√≠cio: Rearrumar palavras", concluido: false },
                    { id: "l2c11e6", texto: "Exerc√≠cio: Formular perguntas (interrogativos)", concluido: false }
                  ],
                  hanzi: [
                    { id: "l2c11h1", texto: "Pr√°tica de Hanzi: Âøô, Á©∫, Êúâ, Âéª, Ë∂Ö, Â∏Ç, ‰∏ú, Ë•ø, ‰Ωè, Ëøò, Áîµ, ËØù, Âè∑, Á†Å, ÂÜç, ËßÅ, Âõû, Êç¢, Èí±, Êù•, Áé©, Áæé, ÂÖÉ, Ê¨ß, ‰∫∫, Ê∞ë, Â∏Å, Â∑¥, Áôæ, ÂçÉ, ‰∏á", concluido: false }
                  ]
                 }
              },
              {
                capitulo: 12,
                tituloCapitulo: "Êàë‰ª¨ÊÄé‰πàÂéª‰ªñÁöÑÂÆ∂?",
                subtopicos: {
                  dialogos: [
                    { id: "l2c12d1", texto: "Di√°logo 1 (Yaoming e Marina planejam ir √† casa de Paulo)", concluido: false },
                    { id: "l2c12d2", texto: "Di√°logo 2 (Professora pergunta sobre transporte)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c12v1", texto: "Vocabul√°rio 1: Âë®Êú´, ÊÄé‰πà, Ê±ΩËΩ¶, Âùê, ÂÖ¨ËΩ¶/ÂÖ¨ÂÖ±Ê±ΩËΩ¶, Êå§, Â§™Êå§‰∫Ü, Âú∞ÈìÅ, Á´ô, Âá∫ÁßüËΩ¶, ÈóÆÈ¢ò, Ê≤°ÈóÆÈ¢ò, Âá∫Âèë, ÊãúÊãú", concluido: false },
                    { id: "l2c12v2", texto: "Vocabul√°rio 2: ÊØè, ÊïôÂÆ§, È™ë, Êë©ÊâòËΩ¶, Ëá™Ë°åËΩ¶, Ëµ∞Ë∑Ø, ÂºÄËΩ¶", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c12g1", texto: "Perguntar 'como?' (transporte) com ÊÄé‰πàÂéª", concluido: false },
                    { id: "l2c12g2", texto: "Verbos para meios de transporte (Âùê, È™ë, ÂºÄ, Ëµ∞Ë∑Ø)", concluido: false },
                    { id: "l2c12g3", texto: "Estrutura S + V(transp) + Meio + V(dir) + Local", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c12e1", texto: "Exerc√≠cio: Formular frases (transporte)", concluido: false },
                    { id: "l2c12e2", texto: "Exerc√≠cio: Ligar Hanzi", concluido: false },
                    { id: "l2c12e3", texto: "Exerc√≠cio: Descrever situa√ß√µes (transporte)", concluido: false },
                    { id: "l2c12e4", texto: "Exerc√≠cio: Rearrumar palavras", concluido: false }
                  ],
                  hanzi: [
                     { id: "l2c12h1", texto: "Pr√°tica de Hanzi: Âë®, Êú´, ÊÄé, ‰πà, Ê±Ω, ËΩ¶, Âùê, ÂÖ¨, ÂÖ±, Êå§, Â§™, ‰∫Ü, Âú∞, ÈìÅ, Á´ô, Âá∫, Áßü, Ê≤°, ÈóÆ, È¢ò, Âèë, Êãú, ÊØè, Êïô, ÂÆ§, È™ë, Êë©, Êâò, Ëá™, Ë°å, Ëµ∞, Ë∑Ø, ÂºÄ", concluido: false }
                  ]
                }
              },
              {
                capitulo: 13,
                tituloCapitulo: "ÊàëË∑üÊúãÂèã‰∏ÄËµ∑ÂêÉÂçàÈ•≠",
                 subtopicos: {
                  dialogos: [
                    { id: "l2c13d1", texto: "Di√°logo 1 (Yaoming ajuda Lia)", concluido: false },
                    { id: "l2c13d2", texto: "Di√°logo 2 (Apresenta√ß√£o de Suzuki/Ling Mu)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c13v1", texto: "Vocabul√°rio 1: ËøòÂ•Ω, ‰∏Ä‰∫õ, Â∏Æ, ‰∏Ä‰∏ã, Áî®, Âú®, ÂêÉÈ•≠ (Êó©/Âçà/ÊôöÈ•≠), ‰∏ÄËµ∑, Èó®Âè£, ËßÅÈù¢", concluido: false },
                    { id: "l2c13v2", texto: "Vocabul√°rio 2: ‰ªãÁªç, Â§ßÂÆ∂Â•Ω, Êó•Êú¨, Âõæ‰π¶È¶Ü, ÂÜô, ‰Ωú‰∏ö, ÊàñËÄÖ, Ë∑ü, Â∏∏/Â∏∏Â∏∏, Áªô, ÊâìÁîµËØù, ÊÉ≥ (saudade), ËÅäÂ§©, Âèë, Áü≠‰ø°", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c13g1", texto: "Preposi√ß√£o Âú® + Local + Verbo", concluido: false },
                    { id: "l2c13g2", texto: "Preposi√ß√£o Ë∑ü + Pessoa + ‰∏ÄËµ∑ + Verbo", concluido: false },
                    { id: "l2c13g3", texto: "Preposi√ß√£o Áªô + Pessoa + Verbo", concluido: false },
                    { id: "l2c13g4", texto: "Diferen√ßa ËøòÊòØ vs ÊàñËÄÖ", concluido: false },
                    { id: "l2c13g5", texto: "Uso de ‰∏Ä‰∏ã", concluido: false },
                    { id: "l2c13g6", texto: "Adv√©rbios de frequ√™ncia Â∏∏/Â∏∏Â∏∏", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c13e1", texto: "Exerc√≠cio: Descrever situa√ß√µes com Âú®", concluido: false },
                    { id: "l2c13e2", texto: "Exerc√≠cio: Descrever situa√ß√µes com Ë∑ü/Áªô", concluido: false },
                    { id: "l2c13e3", texto: "Exerc√≠cio: Audi√ß√£o (Caixa Postal)", concluido: false },
                    { id: "l2c13e4", texto: "Exerc√≠cio: Ligar Hanzi", concluido: false },
                    { id: "l2c13e5", texto: "Exerc√≠cio: Leitura e interpreta√ß√£o", concluido: false },
                    { id: "l2c13e6", texto: "Exerc√≠cio: Rearrumar palavras (preposi√ß√µes)", concluido: false },
                    { id: "l2c13e7", texto: "Exerc√≠cio: Preencher com preposi√ß√µes", concluido: false },
                    { id: "l2c13e8", texto: "Exerc√≠cio: Responder perguntas pessoais", concluido: false }
                  ],
                   hanzi: [
                     { id: "l2c13h1", texto: "Pr√°tica de Hanzi: Ëøò, Â•Ω, ‰∏Ä, ‰∫õ, Â∏Æ, ‰∏ã, Áî®, Âú®, ÂêÉ, È•≠, Êó©, Âçà, Êôö, Ëµ∑, Èó®, Âè£, ËßÅ, Èù¢, ‰ªã, Áªç, Â§ß, ÂÆ∂, Êó•, Êú¨, Âõæ, ‰π¶, È¶Ü, ÂÜô, ‰Ωú, ‰∏ö, Êàñ, ËÄÖ, Ë∑ü, Â∏∏, Áªô, Êâì, Áîµ, ËØù, ÊÉ≥, ËÅä, Â§©, Âèë, Áü≠, ‰ø°", concluido: false }
                  ]
                }
              },
               {
                capitulo: 14,
                tituloCapitulo: "Â•π‰∏çËÉΩÂéª,Â•πË¶Å‰ºëÊÅØ",
                subtopicos: {
                  dialogos: [
                    { id: "l2c14d1", texto: "Di√°logo 1 (Paulo convida Marina - prova)", concluido: false },
                    { id: "l2c14d2", texto: "Di√°logo 2 (Suzuki e Xiaolong - fim de semana)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c14v1", texto: "Vocabul√°rio 1: ‰∫ã, Â§ç‰π†, ÊÉ≥ (desejo), ÁîµÂΩ±, ‰∏ã (pr√≥ximo), ‰∏ä (passado), ËÄÉËØï, Ê≤°ÂÖ≥Á≥ª, ËàíÊúç, ‰∏çËàíÊúç, ËÉΩ, Ë¶Å (inten√ß√£o), ‰ºëÊÅØ", concluido: false },
                    { id: "l2c14v2", texto: "Vocabul√°rio 2: Â§ßÂ≠¶, ‰∏≠Â≠¶, Â∞èÂ≠¶, ‰∏ÄÂÆö, Âì™ÈáåÂì™Èáå, ‰∏ÄËà¨, ÂÖ¨Âõ≠, Ë∑ëÊ≠•, ÊúâÊó∂ÂÄô, ÂìéÂëÄ", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c14g1", texto: "Verbos modais ÊÉ≥ (desejo), Ë¶Å (inten√ß√£o), ËÉΩ (habilidade/permiss√£o)", concluido: false },
                    { id: "l2c14g2", texto: "Diferen√ßa ÊÉ≥ vs Ë¶Å", concluido: false },
                    { id: "l2c14g3", texto: "Adv√©rbios de frequ√™ncia ‰∏ÄËà¨, ÊúâÊó∂ÂÄô", concluido: false },
                    { id: "l2c14g4", texto: "Uso de ‰∏ã‰∏™ / ‰∏ä‰∏™", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c14e1", texto: "Exerc√≠cio: Descrever situa√ß√µes com ÊÉ≥", concluido: false },
                    { id: "l2c14e2", texto: "Exerc√≠cio: Descrever situa√ß√µes com Ë¶Å", concluido: false },
                    { id: "l2c14e3", texto: "Exerc√≠cio: Descrever situa√ß√µes com ËÉΩ", concluido: false },
                    { id: "l2c14e4", texto: "Exerc√≠cio: Ligar Hanzi", concluido: false },
                    { id: "l2c14e5", texto: "Exerc√≠cio: Preencher com verbos modais", concluido: false },
                    { id: "l2c14e6", texto: "Exerc√≠cio: Responder perguntas pessoais", concluido: false }
                  ],
                   hanzi: [
                    { id: "l2c14h1", texto: "Pr√°tica de Hanzi: ‰∫ã, Â§ç, ‰π†, ÊÉ≥, Áîµ, ÂΩ±, ‰∏ã, ‰∏ä, ËÄÉ, ËØï, Ê≤°, ÂÖ≥, Á≥ª, Ëàí, Êúç, ËÉΩ, Ë¶Å, ‰ºë, ÊÅØ, Âåó, ‰∫¨, Â§ß, Â≠¶, ‰∏≠, Â∞è, ‰∏Ä, ÂÆö, Âì™, Èáå, Ëà¨, ÂÖ¨, Âõ≠, Ë∑ë, Ê≠•, Êúâ, Êó∂, ÂÄô, Âìé, ÂëÄ", concluido: false }
                  ]
                }
              },
               {
                capitulo: 15,
                tituloCapitulo: "‰ªéËøôÈáåÂà∞ÈïøÂüéÊÄé‰πàÂéª?",
                subtopicos: {
                  dialogos: [
                    { id: "l2c15d1", texto: "Di√°logo 1 (Paulo convida Marina √† Muralha)", concluido: false },
                    { id: "l2c15d2", texto: "Di√°logo 2 (Marina e Yaoming na Muralha)", concluido: false },
                    { id: "l2c15d3", texto: "Texto (Lia sobre rotina de estudos)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c15v1", texto: "Vocabul√°rio 1: Êó∂Èó¥, ÈïøÂüé, ‰ªé, Âà∞, Á∫ø, ÂíñÂï°Â∫ó, Á≠â", concluido: false },
                    { id: "l2c15v2", texto: "Vocabul√°rio 2: Á¨¨, Ê¨°, ÁúüÁöÑ, ÁªÉ‰π†, Âè£ËØ≠, ËØ≠Èü≥, Ê≤°‰∫ã, Ëµ∞Âêß, ËØ≠Ê≥ï, Ê±âÂ≠ó", concluido: false },
                    { id: "l2c15v3", texto: "Vocabul√°rio 3: Âê¨, ÂØπËØù, ËØ¥", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c15g1", texto: "Preposi√ß√£o ‰ªé...Âà∞ (lugar)", concluido: false },
                    { id: "l2c15g2", texto: "Preposi√ß√£o ‰ªé...Âà∞ (tempo)", concluido: false },
                    { id: "l2c15g3", texto: "N√∫meros ordinais com Á¨¨", concluido: false },
                    { id: "l2c15g4", texto: "As quatro habilidades (Âê¨, ËØ¥, ËØª, ÂÜô)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c15e1", texto: "Exerc√≠cio: Descrever percursos com ‰ªé", concluido: false },
                    { id: "l2c15e2", texto: "Exerc√≠cio: Descrever per√≠odos com ‰ªé...Âà∞", concluido: false },
                    { id: "l2c15e3", texto: "Exerc√≠cio: Leitura e interpreta√ß√£o (rotina)", concluido: false },
                    { id: "l2c15e4", texto: "Exerc√≠cio: Rearrumar palavras (‰ªé/Âà∞)", concluido: false },
                    { id: "l2c15e5", texto: "Exerc√≠cio: Responder perguntas (rotina, estudos)", concluido: false }
                  ],
                   hanzi: [
                     { id: "l2c15h1", texto: "Pr√°tica de Hanzi: Êó∂, Èó¥, Èïø, Âüé, ‰ªé, Âà∞, Á∫ø, Âíñ, Âï°, Â∫ó, Á≠â, Á¨¨, Ê¨°, Áúü, ÁöÑ, ÁªÉ, ‰π†, Âè£, ËØ≠, Èü≥, Ê≤°, ‰∫ã, Ëµ∞, Âêß, Ê≥ï, Ê±â, Â≠ó, Âê¨, ÂØπ, ËØù, ËØ¥", concluido: false }
                  ]
                }
              },
               {
                capitulo: 16,
                tituloCapitulo: "‰Ω†Âú®ÂÅö‰ªÄ‰πàÂë¢?",
                subtopicos: {
                   dialogos: [
                    { id: "l2c16d1", texto: "Di√°logo 1 (Xiaolong e Paulo - futebol)", concluido: false },
                    { id: "l2c16d2", texto: "Di√°logo 2 (Marina convida Yaoming - gin√°sio)", concluido: false },
                    { id: "l2c16d3", texto: "Texto (Lia apresenta esportes ingleses)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l2c16v1", texto: "Vocabul√°rio 1: Âú®...Âë¢, Âä†Ê≤π, ÊâãÊú∫, ÊìçÂú∫, ËøêÂä®, ÈîªÁÇº, Ë∏¢, Ë∂≥ÁêÉ, Êâì, ÁØÆÁêÉ, ‰∏ãÊ¨°, ‰∏äÊ¨°, Âïä", concluido: false },
                    { id: "l2c16v2", texto: "Vocabul√°rio 2: ÊØîËµõ, ‰ΩìËÇ≤È¶Ü, ÂñúÊ¨¢, ÊúâÁöÑ, Ê∏∏Ê≥≥, Á©ø, Ë°£Êúç", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c16g1", texto: "Estrutura Âú®...Âë¢ (presente cont√≠nuo)", concluido: false },
                    { id: "l2c16g2", texto: "Nega√ß√£o do presente cont√≠nuo (Ê≤°Âú®)", concluido: false },
                    { id: "l2c16g3", texto: "Estrutura ÊúâÁöÑ... ÊúâÁöÑ...", concluido: false },
                    { id: "l2c16g4", texto: "Verbos para esportes (Ë∏¢, Êâì, Ê∏∏Ê≥≥, Ë∑ëÊ≠•)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c16e1", texto: "Exerc√≠cio: Descrever a√ß√µes em progresso", concluido: false },
                    { id: "l2c16e2", texto: "Exerc√≠cio: Leitura e interpreta√ß√£o (esportes)", concluido: false },
                    { id: "l2c16e3", texto: "Exerc√≠cio: Reescrever frases na negativa (presente cont√≠nuo)", concluido: false }
                  ],
                  hanzi: [
                    { id: "l2c16h1", texto: "Pr√°tica de Hanzi: Âú®, Âë¢, Âä†, Ê≤π, Êâã, Êú∫, Êìç, Âú∫, Ëøê, Âä®, Èîª, ÁÇº, Ë∏¢, Ë∂≥, ÁêÉ, Êâì, ÁØÆ, ‰∏ã, Ê¨°, ‰∏ä, Âïä, ÊØî, Ëµõ, ‰Ωì, ËÇ≤, È¶Ü, Âñú, Ê¨¢, Êúâ, ÁöÑ, Ê∏∏, Ê≥≥, Á©ø, Ë°£, Êúç", concluido: false }
                  ]
                }
              }
            ]
          }
        ]; // Fim da checklistData

        // --- Estado do Aplicativo ---
        let currentData = [];
        let currentView = 'main';
        let currentChapter = { livroIndex: -1, capituloIndex: -1 };

        // --- Elementos DOM ---
        const appDiv = document.getElementById('app');
        const mainScreen = document.getElementById('main-screen');
        const chapterScreen = document.getElementById('chapter-screen');
        const booksListDiv = document.getElementById('books-list');
        const chapterContentDiv = document.getElementById('chapter-content');
        const backButton = document.getElementById('back-button');
        const chapterTitleH1 = document.getElementById('chapter-title');
        const progressBarTotal = document.getElementById('progress-bar-total');
        const progressTextTotal = document.getElementById('progress-text-total');
        const progressBarChapterDetail = document.getElementById('progress-bar-chapter-detail');
        const progressTextChapterDetail = document.getElementById('progress-text-chapter-detail');
        
        // --- Elementos do PDF Viewer e Anota√ß√µes ---
        const showPdfButton = document.getElementById('show-pdf-button');
        const hidePdfButton = document.getElementById('hide-pdf-button');
        const toggleAnnotationsButton = document.getElementById('toggle-annotations-button');
        const pdfCanvas = document.getElementById('pdf-canvas');
        const pdfLoading = document.getElementById('pdf-loading');
        const chapterAnnotationsTextarea = document.getElementById('chapter-annotations');
        
        // --- Elementos do Layout Principal ---
        const bookSelector = document.getElementById('book-selector');
        const mainPdfCanvas = document.getElementById('main-pdf-canvas');
        const mainPdfLoading = document.getElementById('main-pdf-loading');
        const mainPdfInfo = document.getElementById('main-pdf-info');
        const pageInfoMain = document.getElementById('page-info-main');
        const prevPageMainButton = document.getElementById('prev-page-main');
        const nextPageMainButton = document.getElementById('next-page-main');
        
        // --- Elementos do Layout Dividido ---
        const splitLayout = document.getElementById('split-layout');
        const traditionalLayout = document.getElementById('traditional-layout');
        const chapterContentSplit = document.getElementById('chapter-content-split');
        const pdfChapterInfo = document.getElementById('pdf-chapter-info');
        const pageInfo = document.getElementById('page-info');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');
        
        // --- Vari√°veis de controle do PDF ---
        let currentPage = 1;
        let startPage = 1;
        let endPage = 1;
        let pdfDoc = null;
        let scale = 1.5;
        
        // --- Vari√°veis do PDF Principal ---
        let mainPdfDoc = null;
        let mainCurrentPage = 1;
        let mainTotalPages = 0;
        
        // Fun√ß√µes do PDF principal na tela dividida
        async function loadMainPdf() {
            console.log('=== INICIANDO loadMainPdf ===');
            console.log('mainPdfCanvas:', mainPdfCanvas);
            console.log('mainPdfLoading:', mainPdfLoading);
            console.log('mainPdfInfo:', mainPdfInfo);
            
            if (!mainPdfCanvas) {
                console.error('‚ùå mainPdfCanvas n√£o encontrado!');
                return;
            }
            
            if (!mainPdfLoading) {
                console.error('‚ùå mainPdfLoading n√£o encontrado!');
                return;
            }
            
            try {
                if (mainPdfLoading) {
                    mainPdfLoading.classList.remove('hidden');
                    mainPdfLoading.textContent = 'üìÑ Carregando PDF principal...';
                }
                
                // Carregar Livro 1 como padr√£o
                const pdfUrl = 'Livro 1 - Irm√£os Mandarim.pdf';
                console.log('Tentando carregar:', pdfUrl);
                
                const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
                mainPdfDoc = pdf;
                mainTotalPages = pdf.numPages;
                mainCurrentPage = 1;
                
                console.log(`‚úÖ PDF principal carregado: ${mainTotalPages} p√°ginas`);
                await renderMainPdfPage();
                updateMainPdfInfo();
                
                mainPdfLoading.classList.add('hidden');
            } catch (error) {
                console.error('‚ùå Erro ao carregar PDF principal:', error);
                if (mainPdfLoading) {
                    mainPdfLoading.innerHTML = '<span class="text-red-500">‚ùå Erro ao carregar PDF: ' + error.message + '</span>';
                    mainPdfLoading.classList.remove('hidden');
                }
            }
        }
        
        async function renderMainPdfPage() {
            if (!mainPdfDoc) return;
            
            try {
                const page = await mainPdfDoc.getPage(mainCurrentPage);
                const scale = 1.0;
                const viewport = page.getViewport({ scale });
                
                const context = mainPdfCanvas.getContext('2d');
                mainPdfCanvas.height = viewport.height;
                mainPdfCanvas.width = viewport.width;
                
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                
                // Sincronizar com cap√≠tulos
                syncChapterHighlight();
                
                // Atualizar info da p√°gina
                updateMainPageInfo();
                
            } catch (error) {
                console.error('Erro ao renderizar p√°gina do PDF principal:', error);
            }
        }
        
        function syncChapterHighlight() {
            // Remove highlight anterior
            document.querySelectorAll('.chapter-item.highlighted').forEach(item => {
                item.classList.remove('highlighted', 'bg-blue-50', 'border-blue-200');
            });
            
            // Expande livros se necess√°rio
            document.querySelectorAll('.collapsed').forEach(book => {
                book.classList.remove('collapsed');
                const bookIndex = book.id.match(/book-(\d+)/)?.[1];
                if (bookIndex) {
                    const chaptersList = document.getElementById(`chapters-list-${bookIndex}`);
                    if (chaptersList) {
                        chaptersList.classList.remove('hidden');
                        localStorage.setItem(`book-${bookIndex}-expanded`, 'true');
                    }
                }
            });
            
            // Encontrar cap√≠tulo correspondente √† p√°gina atual
            const currentChapterInfo = findChapterByPage(mainCurrentPage);
            if (currentChapterInfo) {
                const { livroIndex, capituloIndex } = currentChapterInfo;
                
                // Destacar cap√≠tulo atual
                const chapterItems = document.querySelectorAll(`.chapter-item`);
                chapterItems.forEach(item => {
                    const onclickAttr = item.querySelector('[onclick]')?.getAttribute('onclick');
                    if (onclickAttr && onclickAttr.includes(`${livroIndex}, ${capituloIndex}`)) {
                        item.classList.add('highlighted', 'bg-blue-50', 'border-blue-200');
                        item.style.borderLeft = '4px solid #3B82F6';
                        
                        // Scroll para o item se necess√°rio
                        item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                });
                
                // Atualizar info do PDF
                const capitulo = currentData[livroIndex].capitulos[capituloIndex];
                mainPdfInfo.textContent = `Livro ${livroIndex + 1} - Cap ${capitulo.capitulo}: ${capitulo.tituloCapitulo}`;
            } else {
                mainPdfInfo.textContent = `P√°gina ${mainCurrentPage} de ${mainTotalPages}`;
            }
        }
        
        function findChapterByPage(pageNumber) {
            // Procurar em ambos os livros qual cap√≠tulo corresponde √† p√°gina
            for (let livroIndex = 0; livroIndex < currentData.length; livroIndex++) {
                const pageMapping = chapterPageMapping[livroIndex];
                if (!pageMapping) continue;
                
                for (let capituloIndex = 0; capituloIndex < currentData[livroIndex].capitulos.length; capituloIndex++) {
                    const capitulo = currentData[livroIndex].capitulos[capituloIndex];
                    const capituloNumber = capitulo.capitulo;
                    const chapterPages = pageMapping[capituloNumber];
                    
                    if (chapterPages && pageNumber >= chapterPages.startPage && pageNumber <= chapterPages.endPage) {
                        return { livroIndex, capituloIndex, capituloNumber };
                    }
                }
            }
            return null;
        }
        
        function updateMainPdfInfo() {
            if (!mainPdfDoc) return;
            syncChapterHighlight();
        }
        
        // Navega√ß√£o do PDF principal
        function goToMainPreviousPage() {
            if (mainCurrentPage > 1) {
                mainCurrentPage--;
                renderMainPdfPage();
            }
        }
        
        function goToMainNextPage() {
            if (mainCurrentPage < mainTotalPages) {
                mainCurrentPage++;
                renderMainPdfPage();
            }
        }
        
        // Fun√ß√£o para trocar de livro
        async function switchToBook(bookIndex) {
            try {
                mainPdfLoading.classList.remove('hidden');
                
                const pdfUrl = `Livro ${bookIndex + 1} - Irm√£os Mandarim.pdf`;
                const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
                mainPdfDoc = pdf;
                mainTotalPages = pdf.numPages;
                mainCurrentPage = 1;
                
                console.log(`Livro ${bookIndex + 1} carregado: ${mainTotalPages} p√°ginas`);
                await renderMainPdfPage();
                updateMainPageInfo();
                
                mainPdfLoading.classList.add('hidden');
            } catch (error) {
                console.error('Erro ao carregar livro:', error);
                mainPdfLoading.innerHTML = '<span class="text-red-500">‚ùå Erro ao carregar livro</span>';
            }
        }
        
        function updateMainPageInfo() {
            if (pageInfoMain) {
                pageInfoMain.textContent = `${mainCurrentPage}/${mainTotalPages}`;
            }
            updateMainPdfInfo();
        }
        
        // Adicionar event listeners para teclado
        document.addEventListener('keydown', (e) => {
            if (currentView === 'main') {
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    goToMainPreviousPage();
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    goToMainNextPage();
                }
            }
        });

        // --- Fun√ß√µes do Checklist COMPLETAS ---
         function calculateSubtopicProgress(subtopicosObj) {
            let total = 0; let completed = 0;
            for (const key in subtopicosObj) { if (Array.isArray(subtopicosObj[key])) { subtopicosObj[key].forEach(item => { if (item.hasOwnProperty('concluido')) { total++; if (item.concluido) completed++; } }); } }
            return total === 0 ? 0 : Math.round((completed / total) * 100);
        }
        function calculateAllProgress() {
            let totalItems = 0; 
            let completedItems = 0; 
            const bookProgress = []; 
            const chapterProgress = [];
            
            currentData.forEach((livro, livroIndex) => { 
                let livroTotal = 0; 
                let livroCompleted = 0; 
                
                livro.capitulos.forEach((cap, capIndex) => { 
                    let capTotal = 0; 
                    let capCompleted = 0; 
                    
                    for (const key in cap.subtopicos) { 
                        if (Array.isArray(cap.subtopicos[key])) { 
                            cap.subtopicos[key].forEach(item => { 
                                if (item.hasOwnProperty('concluido')) { 
                                    capTotal++; 
                                    if (item.concluido) capCompleted++; 
                                } 
                            }); 
                        } 
                    } 
                    
                    livroTotal += capTotal; 
                    livroCompleted += capCompleted; 
                    totalItems += capTotal; 
                    completedItems += capCompleted; 
                    
                    const progress = capTotal === 0 ? 0 : Math.round((capCompleted / capTotal) * 100); 
                    chapterProgress.push({ livro: livroIndex, capitulo: capIndex, progress: progress }); 
                }); 
                
                const progress = livroTotal === 0 ? 0 : Math.round((livroCompleted / livroTotal) * 100); 
                bookProgress.push(progress); 
                
                console.log(`Livro ${livroIndex + 1}: ${livroCompleted}/${livroTotal} itens (${progress}%)`);
            });
            
            const totalProgress = totalItems === 0 ? 0 : Math.round((completedItems / totalItems) * 100); 
            console.log(`PROGRESSO TOTAL: ${completedItems}/${totalItems} itens (${totalProgress}%)`);
            console.log('Progresso por livro:', bookProgress);
            
            return { totalProgress, bookProgress, chapterProgress, totalItems, completedItems };
        }
        function updateProgressDisplay() {
            const { totalProgress, bookProgress, chapterProgress } = calculateAllProgress();
            progressBarTotal.style.width = `${totalProgress}%`; progressBarTotal.textContent = totalProgress > 10 ? `${totalProgress}%` : ''; progressTextTotal.textContent = `${totalProgress}%`;
            currentData.forEach((livro, index) => { const bar = document.getElementById(`progress-bar-book-${index}`); const text = document.getElementById(`progress-text-book-${index}`); if(bar && text) { const progress = bookProgress[index]; bar.style.width = `${progress}%`; bar.textContent = progress > 10 ? `${progress}%` : ''; text.textContent = `${progress}%`; } });
             chapterProgress.forEach(cp => { const bar = document.getElementById(`progress-bar-chapter-${cp.livro}-${cp.capitulo}`); const text = document.getElementById(`progress-text-chapter-${cp.livro}-${cp.capitulo}`); if (bar && text) { bar.style.width = `${cp.progress}%`; text.textContent = `${cp.progress}%`; } });
            if (currentView === 'chapter' && currentChapter.livroIndex !== -1 && currentChapter.capituloIndex !== -1 && currentData[currentChapter.livroIndex] && currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex]) { // Checagem extra
                const currentCapProgress = chapterProgress.find(cp => cp.livro === currentChapter.livroIndex && cp.capitulo === currentChapter.capituloIndex)?.progress || 0;
                 progressBarChapterDetail.style.width = `${currentCapProgress}%`; progressBarChapterDetail.textContent = currentCapProgress > 10 ? `${currentCapProgress}%` : ''; progressTextChapterDetail.textContent = `${currentCapProgress}%`;
                 const capitulo = currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex];
                 const titleElement = document.getElementById('chapter-title');
                 if (titleElement) titleElement.textContent = `Livro ${currentChapter.livroIndex + 1} - Cap ${capitulo.capitulo}: ${capitulo.tituloCapitulo}`;
            }
        }
       function renderMainScreen() {
            console.log('Renderizando tela principal...', currentData);
            
            // Remove o status de carregamento
            const loadingStatus = document.getElementById('loading-status');
            if (loadingStatus) {
                loadingStatus.style.display = 'none';
            }
            
            booksListDiv.innerHTML = ''; // Limpa antes de renderizar
            
            if (!currentData || currentData.length === 0) {
                console.error('currentData est√° vazio ou inv√°lido');
                booksListDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        <h3 class="font-bold">‚ùå Erro: Dados n√£o carregaram</h3>
                        <p>currentData est√° vazio. Verifique o console para mais detalhes.</p>
                        <button onclick="location.reload()" class="mt-2 bg-red-500 text-white px-3 py-1 rounded text-sm">
                            Recarregar P√°gina
                        </button>
                    </div>
                `;
                return;
            }
            
            currentData.forEach((livro, livroIndex) => {
                console.log(`Renderizando livro ${livroIndex}:`, livro);
                const isBookExpanded = localStorage.getItem(`book-${livroIndex}-expanded`) !== 'false';
                console.log(`Livro ${livroIndex} expandido:`, isBookExpanded);
                
                const bookDiv = document.createElement('div'); 
                bookDiv.className = `bg-white rounded-lg shadow border border-gray-200 ${isBookExpanded ? '' : 'collapsed'}`; 
                bookDiv.id = `book-${livroIndex}`;
                
                const bookHeader = document.createElement('div'); 
                bookHeader.className = 'p-4 cursor-pointer flex justify-between items-center'; 
                bookHeader.onclick = () => toggleBook(livroIndex);
                
                const bookTitle = document.createElement('h2'); 
                bookTitle.className = 'text-lg md:text-xl font-semibold text-gray-700 flex items-center'; 
                bookTitle.innerHTML = `<span class="toggle-icon mr-2"></span> ${livro.tituloLivro}`; 
                bookHeader.appendChild(bookTitle);
                
                const bookProgressDiv = document.createElement('div'); 
                bookProgressDiv.className = 'w-1/3 md:w-1/4 ml-4'; 
                bookProgressDiv.innerHTML = `<div class="progress-bar-bg"><div id="progress-bar-book-${livroIndex}" class="progress-bar-fill"></div></div><p id="progress-text-book-${livroIndex}" class="text-right text-xs font-medium text-gray-600 mt-1">0%</p>`; 
                bookHeader.appendChild(bookProgressDiv); 
                bookDiv.appendChild(bookHeader);
                
                const chaptersList = document.createElement('ul'); 
                chaptersList.className = `border-t border-gray-200 ${isBookExpanded ? '' : 'hidden'}`; 
                chaptersList.id = `chapters-list-${livroIndex}`;
                
                if(livro.capitulos && Array.isArray(livro.capitulos)) {
                    console.log(`Livro ${livroIndex} tem ${livro.capitulos.length} cap√≠tulos`);
                    livro.capitulos.forEach((cap, capIndex) => {
                        const li = document.createElement('li'); 
                        li.className = 'border-b border-gray-100 last:border-b-0 chapter-item cursor-pointer transition duration-150 ease-in-out';
                        li.innerHTML = `<div class="p-3 px-4 flex justify-between items-center" onclick="showChapterDetail(${livroIndex}, ${capIndex})"><span class="text-gray-700">Cap ${cap.capitulo}: ${cap.tituloCapitulo}</span><div class="w-1/4 md:w-1/5 ml-2 text-right"><div class="progress-bar-bg !h-3"><div id="progress-bar-chapter-${livroIndex}-${capIndex}" class="progress-bar-fill !text-transparent"></div></div><p id="progress-text-chapter-${livroIndex}-${capIndex}" class="text-xs font-medium text-gray-500">0%</p></div></div>`; 
                        chaptersList.appendChild(li);
                    });
                } else {
                    console.error(`Livro ${livroIndex} n√£o tem cap√≠tulos v√°lidos:`, livro.capitulos);
                }
                
                bookDiv.appendChild(chaptersList); 
                booksListDiv.appendChild(bookDiv);
            });
            
            updateProgressDisplay();
            
            // Adiciona informa√ß√£o de sucesso
            const successDiv = document.createElement('div');
            successDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mt-4';
            successDiv.innerHTML = `
                <p>‚úÖ <strong>Dados carregados com sucesso!</strong></p>
                <p class="text-sm">Renderizados ${currentData.length} livros com ${currentData.reduce((total, livro) => total + (livro.capitulos?.length || 0), 0)} cap√≠tulos.</p>
            `;
            booksListDiv.appendChild(successDiv);
            
            console.log(`Renderiza√ß√£o conclu√≠da: ${currentData.length} livros, ${currentData.reduce((total, livro) => total + (livro.capitulos?.length || 0), 0)} cap√≠tulos`);
        }
        function renderChapterDetail(livroIndex, capituloIndex) {
             if (!currentData[livroIndex] || !currentData[livroIndex].capitulos[capituloIndex]) {
                 console.error("Dados inv√°lidos para renderChapterDetail:", livroIndex, capituloIndex);
                 showMainScreen(); // Volta para tela principal se dados inv√°lidos
                 return;
             }
            const capitulo = currentData[livroIndex].capitulos[capituloIndex]; currentChapter = { livroIndex, capituloIndex }; chapterContentDiv.innerHTML = ''; // Limpa antes de renderizar
            const subtopicSections = [{ title: 'T√ìPICOS', key: 'topicos'}, { title: 'DI√ÅLOGOS', key: 'dialogos' },{ title: 'VOCABUL√ÅRIO', key: 'vocabulario' }, { title: 'GRAM√ÅTICA E ESTRUTURAS', key: 'gramatica' }, { title: 'TEXTO(S)', key: 'textos' }, { title: 'APRESENTA√á√ÉO(√ïES)', key: 'apresentacoes' }, { title: 'EXERC√çCIOS', key: 'exercicios' }, { title: 'CARACTERES (HANZI)', key: 'hanzi' }];
             subtopicSections.forEach(section => { const items = capitulo.subtopicos[section.key]; if (items && Array.isArray(items) && items.length > 0) { const sectionDiv = document.createElement('div'); const sectionTitle = document.createElement('h3'); sectionTitle.className = 'text-md font-semibold mb-2 text-gray-600 border-b pb-1'; sectionTitle.textContent = section.title; sectionDiv.appendChild(sectionTitle); const ul = document.createElement('ul'); ul.className = 'space-y-1'; items.forEach(item => { const li = document.createElement('li'); li.className = `flex items-center text-sm ${item.concluido ? 'completed-item' : ''}`; li.innerHTML = `<input type="checkbox" id="${item.id}" data-livro="${livroIndex}" data-capitulo="${capituloIndex}" data-key="${section.key}" data-itemid="${item.id}" ${item.concluido ? 'checked' : ''} class="mr-2 h-4 w-4 rounded border-gray-300 text-emerald-500 focus:ring-emerald-400 cursor-pointer"><label for="${item.id}" class="text-gray-700 cursor-pointer">${item.texto}</label>`; const checkbox = li.querySelector('input[type="checkbox"]'); if(checkbox) { checkbox.addEventListener('change', handleCheckboxChange); } ul.appendChild(li); }); sectionDiv.appendChild(ul); chapterContentDiv.appendChild(sectionDiv); } });
            updateProgressDisplay(); // Atualiza a barra de progresso do cap√≠tulo

            // --- IN√çCIO DA ADI√á√ÉO: Se√ß√£o de Notas ---
            const notesSection = document.createElement('div');
            notesSection.className = 'mt-6 pt-4 border-t border-gray-200'; // Margem e separador
            
            const notesTitle = document.createElement('h3');
            notesTitle.className = 'text-md font-semibold mb-2 text-gray-600';
            notesTitle.textContent = 'NOTAS DO CAP√çTULO';
            notesSection.appendChild(notesTitle);
            
            const notesTextarea = document.createElement('textarea');
            const notesKey = `mandarinNotes-l${livroIndex}c${capituloIndex}`; // Chave √∫nica para localStorage
            
            notesTextarea.id = `notes-${livroIndex}-${capituloIndex}`;
            notesTextarea.className = 'notes-textarea';
            notesTextarea.placeholder = 'Digite seus coment√°rios, d√∫vidas ou notas sobre este cap√≠tulo...';
            
            // Carrega as notas salvas do localStorage
            notesTextarea.value = localStorage.getItem(notesKey) || '';
            
            // Salva as notas automaticamente ao digitar (com um pequeno atraso para efici√™ncia)
            let debounceTimer;
            notesTextarea.addEventListener('keyup', () => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    localStorage.setItem(notesKey, notesTextarea.value);
                }, 300); // Salva 300ms ap√≥s o usu√°rio parar de digitar
            });
            
            notesSection.appendChild(notesTextarea);
            chapterContentDiv.appendChild(notesSection);
            // --- FIM DA ADI√á√ÉO ---
        }
       function showChapterDetail(livroIndex, capituloIndex) { currentView = 'chapter'; mainScreen.classList.add('hidden'); chapterScreen.classList.remove('hidden'); renderChapterDetail(livroIndex, capituloIndex); window.scrollTo(0, 0); }
       function showMainScreen() { currentView = 'main'; chapterScreen.classList.add('hidden'); mainScreen.classList.remove('hidden'); currentChapter = { livroIndex: -1, capituloIndex: -1 }; renderMainScreen(); } // Renderiza main screen ao voltar
       function handleCheckboxChange(event) {
            const checkbox = event.target; const livroIndex = parseInt(checkbox.dataset.livro); const capIndex = parseInt(checkbox.dataset.capitulo); const key = checkbox.dataset.key; const itemId = checkbox.dataset.itemid; const isChecked = checkbox.checked;
            try { const item = currentData[livroIndex].capitulos[capIndex].subtopicos[key].find(i => i.id === itemId); if (item) { item.concluido = isChecked; checkbox.closest('li').classList.toggle('completed-item', isChecked); saveProgress(); updateProgressDisplay(); } else { console.error("Item not found:", itemId, "in", key); } } catch (e) { console.error("Error updating item state:", e, {livroIndex, capIndex, key, itemId}); }
        }
       function toggleBook(livroIndex) { const bookDiv = document.getElementById(`book-${livroIndex}`); const chaptersList = document.getElementById(`chapters-list-${livroIndex}`); if(bookDiv && chaptersList) { const isCollapsed = bookDiv.classList.toggle('collapsed'); chaptersList.classList.toggle('hidden'); localStorage.setItem(`book-${livroIndex}-expanded`, !isCollapsed); } else { console.error("Could not find book elements for toggling:", livroIndex); } }
       function saveProgress() { try { localStorage.setItem('mandarinProgressData', JSON.stringify(currentData)); } catch (e) { console.error("Erro ao salvar progresso:", e); alert("Erro ao salvar progresso. Pode ser que o armazenamento local esteja cheio.");} } // Adiciona alerta
        function loadProgress() {
            const savedData = localStorage.getItem('mandarinProgressData'); let dataToUse = checklistData; // Usa checklistData como padr√£o
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    // Valida√ß√£o b√°sica da estrutura salva
                    if (Array.isArray(parsedData) && parsedData.length === checklistData.length &&
                        parsedData.every(book => book && Array.isArray(book.capitulos)))
                    {
                        // Merge profundo para preservar estrutura e IDs originais, atualizando apenas 'concluido'
                        dataToUse = checklistData.map((bookDefault, bookIndex) => ({
                            ...bookDefault,
                            capitulos: bookDefault.capitulos.map((chapterDefault, chapterIndex) => {
                                const savedChapter = parsedData[bookIndex]?.capitulos[chapterIndex];
                                const mergedSubtopicos = {};
                                for (const key in chapterDefault.subtopicos) {
                                    if (Array.isArray(chapterDefault.subtopicos[key])) {
                                        mergedSubtopicos[key] = chapterDefault.subtopicos[key].map(itemDefault => {
                                            const savedItem = savedChapter?.subtopicos?.[key]?.find(i => i.id === itemDefault.id);
                                            // Garante que 'concluido' seja boolean
                                            const concluidoState = savedItem ? !!savedItem.concluido : false;
                                            return { ...itemDefault, concluido: concluidoState };
                                        });
                                    }
                                }
                                return { ...chapterDefault, subtopicos: mergedSubtopicos };
                            })
                        }));
                        console.log("Progresso carregado do LocalStorage.");
                    } else {
                        console.warn("Estrutura salva inv√°lida ou incompat√≠vel. Usando dados padr√£o.");
                        localStorage.removeItem('mandarinProgressData'); // Limpa dados inv√°lidos
                        dataToUse = checklistData; // Garante que est√° usando o padr√£o
                    }
                } catch (e) {
                    console.error("Erro ao carregar/parsear progresso:", e);
                    localStorage.removeItem('mandarinProgressData'); // Limpa dados corrompidos
                    dataToUse = checklistData; // Garante que est√° usando o padr√£o
                }
            } else {
                console.log("Nenhum progresso salvo encontrado. Usando dados padr√£o.");
                dataToUse = checklistData; // Garante que est√° usando o padr√£o
            }
             // Cria uma c√≥pia profunda para evitar muta√ß√µes inesperadas no objeto original
            currentData = JSON.parse(JSON.stringify(dataToUse));
        }
        // --- FIM DAS FUN√á√ïES DO CHECKLIST ---

        // --- Configura√ß√£o do PDF.js ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';

        // --- Fun√ß√µes do PDF Viewer e Anota√ß√µes ---
        async function showPdfViewer() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            // Obter informa√ß√µes do cap√≠tulo
            const livroNumber = currentChapter.livroIndex + 1;
            const capitulo = currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex];
            const capituloNumber = capitulo.capitulo;
            const pageMapping = chapterPageMapping[currentChapter.livroIndex];
            
            console.log(`Debug: livroIndex=${currentChapter.livroIndex}, capituloIndex=${currentChapter.capituloIndex}, capituloNumber=${capituloNumber}`);
            
            if (!pageMapping || !pageMapping[capituloNumber]) {
                alert(`Mapeamento de p√°ginas n√£o encontrado para Livro ${livroNumber}, Cap√≠tulo ${capituloNumber}.`);
                return;
            }
            
            // Configurar p√°ginas do cap√≠tulo
            const chapterPages = pageMapping[capituloNumber];
            startPage = chapterPages.startPage;
            endPage = chapterPages.endPage;
            currentPage = startPage;
            
            // Configurar interface
            pdfChapterInfo.textContent = `${capitulo.tituloCapitulo} (P√°ginas ${startPage}-${endPage})`;
            
            // Carregar PDF
            const pdfFileName = `Livro ${livroNumber} - Irm√£os Mandarim.pdf`;
            await loadPdf(pdfFileName);
            
            // Renderizar checklist no layout dividido
            renderChapterContentSplit();
            
            // Carregar anota√ß√µes
            loadChapterAnnotations();
            
            // Mostrar layout dividido
            traditionalLayout.classList.add('hidden');
            splitLayout.classList.remove('hidden');
            showPdfButton.classList.add('hidden');
            hidePdfButton.classList.remove('hidden');
            
            console.log(`Abrindo PDF: ${pdfFileName}, P√°ginas: ${startPage}-${endPage}`);
        }
        
        async function loadPdf(pdfUrl) {
            try {
                pdfLoading.classList.remove('hidden');
                console.log('Carregando PDF:', pdfUrl);
                
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                pdfDoc = await loadingTask.promise;
                
                console.log(`PDF carregado. Total de p√°ginas: ${pdfDoc.numPages}`);
                
                // Validar se as p√°ginas do cap√≠tulo existem no PDF
                if (startPage > pdfDoc.numPages) {
                    console.error(`P√°gina inicial ${startPage} n√£o existe no PDF (total: ${pdfDoc.numPages})`);
                    alert(`Erro: P√°gina ${startPage} n√£o encontrada no PDF. O arquivo pode estar incompleto.`);
                    return;
                }
                
                // Ajustar endPage se for maior que o total de p√°ginas
                if (endPage > pdfDoc.numPages) {
                    console.warn(`P√°gina final ${endPage} ajustada para ${pdfDoc.numPages}`);
                    endPage = pdfDoc.numPages;
                }
                
                // Renderizar primeira p√°gina do cap√≠tulo
                await renderPage(currentPage);
                
                pdfLoading.classList.add('hidden');
            } catch (error) {
                console.error('Erro ao carregar PDF:', error);
                pdfLoading.textContent = 'Erro ao carregar PDF';
                alert('Erro ao carregar o PDF. Verifique se o arquivo existe.');
            }
        }
        
        async function renderPage(pageNum) {
            try {
                console.log(`Renderizando p√°gina ${pageNum}`);
                pdfLoading.classList.remove('hidden');
                
                const page = await pdfDoc.getPage(pageNum);
                const viewport = page.getViewport({ scale: scale });
                
                // Configurar canvas
                const context = pdfCanvas.getContext('2d');
                pdfCanvas.height = viewport.height;
                pdfCanvas.width = viewport.width;
                
                // Renderizar p√°gina
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                
                // Atualizar controles
                updatePageControls();
                
                pdfLoading.classList.add('hidden');
                console.log(`P√°gina ${pageNum} renderizada`);
                
            } catch (error) {
                console.error('Erro ao renderizar p√°gina:', error);
                pdfLoading.textContent = 'Erro ao renderizar p√°gina';
            }
        }
        
        function updatePageControls() {
            // Calcular p√°gina relativa ao cap√≠tulo (1, 2, 3...)
            const relativePageNum = currentPage - startPage + 1;
            const totalChapterPages = endPage - startPage + 1;
            
            pageInfo.textContent = `${relativePageNum}/${totalChapterPages}`;
            
            // Controlar bot√µes
            prevPageButton.disabled = currentPage <= startPage;
            nextPageButton.disabled = currentPage >= endPage;
            
            prevPageButton.classList.toggle('opacity-50', currentPage <= startPage);
            nextPageButton.classList.toggle('opacity-50', currentPage >= endPage);
        }
        
        function hidePdfViewer() {
            // Esconder layout dividido
            splitLayout.classList.add('hidden');
            traditionalLayout.classList.remove('hidden');
            hidePdfButton.classList.add('hidden');
            showPdfButton.classList.remove('hidden');
            
            // Limpar PDF
            if (pdfCanvas) {
                const context = pdfCanvas.getContext('2d');
                context.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
            }
            pdfDoc = null;
            
            console.log('PDF fechado');
        }
        
        async function prevPage() {
            if (currentPage > startPage) {
                currentPage--;
                await renderPage(currentPage);
            }
        }
        
        async function nextPage() {
            if (currentPage < endPage) {
                currentPage++;
                await renderPage(currentPage);
            }
        }
        
        function renderChapterContentSplit() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            console.log('Renderizando checklist dividido...');
            
            const capitulo = currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex];
            
            // Verifica se o elemento principal existe
            if (!chapterContentSplit) {
                console.error('chapterContentSplit n√£o encontrado');
                return;
            }
            
            // Procura pelo div de conte√∫do
            let contentDiv = chapterContentSplit.querySelector('.p-2.space-y-2');
            
            if (!contentDiv) {
                console.log('Div de conte√∫do n√£o encontrado, tentando criar...');
                // Se n√£o encontrou, tenta o div pai e procura estrutura alternativa
                const parentDiv = chapterContentSplit.querySelector('div');
                if (parentDiv && parentDiv.children.length > 1) {
                    contentDiv = parentDiv.children[1]; // O segundo div deve ser o conte√∫do
                }
            }
            
            if (!contentDiv) {
                console.error('N√£o foi poss√≠vel encontrar ou criar div de conte√∫do');
                return;
            }
            
            contentDiv.innerHTML = '';
            console.log('Limpou conte√∫do, iniciando renderiza√ß√£o...');
            
            const subtopicSections = [
                { title: 'T√ìPICOS', key: 'topicos'},
                { title: 'DI√ÅLOGOS', key: 'dialogos' },
                { title: 'VOCABUL√ÅRIO', key: 'vocabulario' }, 
                { title: 'GRAM√ÅTICA', key: 'gramatica' }, 
                { title: 'EXERC√çCIOS', key: 'exercicios' }, 
                { title: 'HANZI', key: 'hanzi' }
            ];
            
            subtopicSections.forEach(section => { 
                const items = capitulo.subtopicos[section.key]; 
                if (items && Array.isArray(items) && items.length > 0) { 
                    const sectionDiv = document.createElement('div'); 
                    const sectionTitle = document.createElement('h4'); 
                    sectionTitle.className = 'text-sm font-semibold mb-1 text-gray-600 border-b pb-1'; 
                    sectionTitle.textContent = section.title; 
                    sectionDiv.appendChild(sectionTitle); 
                    
                    const ul = document.createElement('ul'); 
                    ul.className = 'space-y-1'; 
                    items.forEach(item => { 
                        const li = document.createElement('li'); 
                        li.className = `flex items-start text-xs ${item.concluido ? 'completed-item' : ''}`; 
                        li.innerHTML = `
                            <input type="checkbox" id="${item.id}-split" data-livro="${currentChapter.livroIndex}" data-capitulo="${currentChapter.capituloIndex}" data-key="${section.key}" data-itemid="${item.id}" ${item.concluido ? 'checked' : ''} class="mr-2 mt-0.5 h-3 w-3 rounded border-gray-300 text-emerald-500 focus:ring-emerald-400 cursor-pointer">
                            <label for="${item.id}-split" class="text-gray-700 cursor-pointer leading-tight">${item.texto}</label>
                        `; 
                        const checkbox = li.querySelector('input[type="checkbox"]'); 
                        if(checkbox) { 
                            checkbox.addEventListener('change', handleCheckboxChange); 
                        } 
                        ul.appendChild(li); 
                    }); 
                    sectionDiv.appendChild(ul); 
                    contentDiv.appendChild(sectionDiv); 
                } 
            });
        }
        
        function loadChapterAnnotations() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            const annotationsKey = `mandarinAnnotations-l${currentChapter.livroIndex}c${currentChapter.capituloIndex}`;
            const savedAnnotations = localStorage.getItem(annotationsKey) || '';
            
            chapterAnnotationsTextarea.value = savedAnnotations;
            console.log(`Carregadas anota√ß√µes para L${currentChapter.livroIndex + 1}C${currentChapter.capituloIndex}: ${savedAnnotations.length} caracteres`);
        }
        
        function saveChapterAnnotations() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            const annotationsKey = `mandarinAnnotations-l${currentChapter.livroIndex}c${currentChapter.capituloIndex}`;
            const annotations = chapterAnnotationsTextarea.value;
            
            localStorage.setItem(annotationsKey, annotations);
            console.log(`Salvas anota√ß√µes para L${currentChapter.livroIndex + 1}C${currentChapter.capituloIndex}: ${annotations.length} caracteres`);
        }

        // --- Fun√ß√£o para resetar dados ---
        function resetData() {
            if (confirm('Tem certeza que deseja resetar todos os dados? Isso apagar√° todo o progresso salvo.')) {
                // Remove todos os dados do localStorage
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('mandarinProgressData') || 
                        key.startsWith('mandarinNotes-') || 
                        key.startsWith('book-') && key.endsWith('-expanded')) {
                        localStorage.removeItem(key);
                    }
                });
                
                console.log('Dados resetados');
                alert('Dados resetados! A p√°gina ser√° recarregada.');
                location.reload();
            }
        }

        // --- Inicializa√ß√£o ---
         function init() {
            console.log('=== INICIANDO APLICATIVO ===');
            console.log('checklistData original:', checklistData);
            console.log('DOM elements check:');
            console.log('- mainPdfCanvas:', document.getElementById('main-pdf-canvas'));
            console.log('- mainPdfLoading:', document.getElementById('main-pdf-loading'));
            console.log('- mainPdfInfo:', document.getElementById('main-pdf-info'));
            
            try {
                loadProgress();
                console.log('currentData ap√≥s loadProgress:', currentData);
                
                if (!currentData || currentData.length === 0) {
                    console.error('ERRO CR√çTICO: currentData est√° vazio!');
                    alert('Erro: Dados n√£o carregaram. Recarregando p√°gina...');
                    location.reload();
                    return;
                }
                
                console.log('üéØ Antes de renderMainScreen');
                try {
                    renderMainScreen();
                    console.log('üéØ Depois de renderMainScreen');
                } catch (error) {
                    console.error('‚ùå Erro em renderMainScreen:', error);
                    console.log('üéØ Continuando apesar do erro...');
                }
                
                // Carregar PDF principal ap√≥s renderiza√ß√£o
                console.log('üéØ Configurando setTimeout para PDF...');
                setTimeout(() => {
                    console.log('üîç Iniciando carregamento do PDF principal...');
                    
                    const mainScreen = document.getElementById('main-screen');
                    const pdfArea = document.querySelector('div.w-1\\/2');
                    const mainPdfCanvas = document.getElementById('main-pdf-canvas');
                    
                    console.log('‚úÖ main-screen found:', !!mainScreen);
                    console.log('‚úÖ PDF area found:', !!pdfArea);
                    console.log('‚úÖ main-pdf-canvas found:', !!mainPdfCanvas);
                    console.log('‚úÖ main-screen visible:', mainScreen && !mainScreen.classList.contains('hidden'));
                    
                    if (mainPdfCanvas) {
                        console.log('üöÄ Chamando loadMainPdf...');
                        loadMainPdf();
                    } else {
                        console.error('‚ùå main-pdf-canvas n√£o encontrado!');
                    }
                }, 1000);
                
                console.log('=== APLICATIVO INICIADO COM SUCESSO ===');
                
            } catch (error) {
                console.error('ERRO na inicializa√ß√£o:', error);
                alert('Erro cr√≠tico na inicializa√ß√£o: ' + error.message);
            }
            
            if(backButton) { // Checa se backButton existe
                 backButton.addEventListener('click', showMainScreen);
            } else {
                 console.error("Back button not found");
            }
            
            // Event listeners para PDF viewer e anota√ß√µes
            if(showPdfButton) {
                showPdfButton.addEventListener('click', showPdfViewer);
            }
            
            if(hidePdfButton) {
                hidePdfButton.addEventListener('click', hidePdfViewer);
            }
            
            if(prevPageButton) {
                prevPageButton.addEventListener('click', prevPage);
            }
            
            if(nextPageButton) {
                nextPageButton.addEventListener('click', nextPage);
            }
            
            // Auto-save para anota√ß√µes
            if(chapterAnnotationsTextarea) {
                let annotationsDebounceTimer;
                chapterAnnotationsTextarea.addEventListener('keyup', () => {
                    clearTimeout(annotationsDebounceTimer);
                    annotationsDebounceTimer = setTimeout(() => {
                        saveChapterAnnotations();
                    }, 300);
                });
            }
            
            // Event listeners para o PDF principal
            if(prevPageMainButton) {
                prevPageMainButton.addEventListener('click', goToMainPreviousPage);
            }
            
            if(nextPageMainButton) {
                nextPageMainButton.addEventListener('click', goToMainNextPage);
            }
            
            if(bookSelector) {
                bookSelector.addEventListener('change', async (e) => {
                    const selectedBookIndex = e.target.value;
                    if (selectedBookIndex !== '') {
                        await switchToBook(parseInt(selectedBookIndex));
                    }
                });
            }
            
        }

        document.addEventListener('DOMContentLoaded', init);

    </script>

    <!-- Script do Chatbase Widget (COLE O SEU AQUI ou logo abaixo) -->
    <script>
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="lQAieVgUdlOSGG5P02Wx_";script.domain="www.chatbase.co";script.defer = true; document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
    </script>

</body>
</html>



