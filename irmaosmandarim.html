<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Progresso Mandarim</title>
    <!-- Inclui Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inclui PDF.js -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <style>
        /* Estilos do Checklist (Inalterados) */
        .progress-bar-bg { background-color: #e5e7eb; border-radius: 0.375rem; overflow: hidden; height: 1.25rem; border: 1px solid #d1d5db; }
        .progress-bar-fill { background-color: #34d399; height: 100%; transition: width 0.3s ease-in-out; text-align: center; color: white; font-size: 0.75rem; line-height: 1.25rem; border-radius: 0.375rem; }
        .completed-item label { text-decoration: line-through; color: #6b7280; }
        .chapter-item:hover { background-color: #f3f4f6; }
        .toggle-icon::before { content: 'â–¼ '; display: inline-block; transition: transform 0.2s ease-in-out; }
        .collapsed .toggle-icon::before { transform: rotate(-90deg); content: 'â–º '; }
        /* Adiciona padding extra no body para evitar que o botÃ£o do chatbase cubra conteÃºdo */
        body { padding-bottom: 80px; }

        /* Estilo para a nova seÃ§Ã£o de Notas */
        .notes-textarea {
            width: 100%;
            height: 150px; /* Altura aumentada */
            padding: 0.75rem; /* p-3 */
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            font-size: 0.875rem; /* text-sm */
            margin-top: 1rem; /* mt-4 */
            resize: vertical; /* Permite redimensionar verticalmente */
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .notes-textarea:focus {
            border-color: #3b82f6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 2px #bfdbfe; /* focus:ring-blue-200 */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans font-family-inter relative min-h-screen">

    <!-- ConteÃºdo Principal do Checklist (Inalterado) -->
    <div id="app" class="container mx-auto p-4 md:p-6 max-w-3xl">
        <!-- Nova Tela Principal - Layout Dividido -->
        <div id="main-screen">
            <!-- CabeÃ§alho -->
            <div class="mb-4">
                <h1 class="text-xl md:text-2xl font-bold mb-2 text-gray-800 text-center">Meu Progresso Mandarim ğŸ“š</h1>
                <div class="bg-white p-3 rounded-lg shadow border border-gray-200">
                    <h2 class="text-md font-semibold mb-2 text-gray-700">Progresso Total</h2>
                    <div class="progress-bar-bg"><div id="progress-bar-total" class="progress-bar-fill"></div></div>
                    <p id="progress-text-total" class="text-right text-sm font-medium text-gray-600 mt-1">0%</p>
                </div>
            </div>

            <!-- Status de carregamento -->
            <div id="loading-status" class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-3 py-2 rounded mb-4">
                <p class="text-sm">ğŸ”„ Carregando dados...</p>
            </div>
            
            <!-- Layout Principal Dividido -->
            <div class="flex flex-row gap-4" style="height: 75vh;">
                <!-- Ãrea do PDF (50%) -->
                <div class="w-1/2 bg-white rounded-lg shadow border border-gray-200">
                    <div class="p-3 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-md font-semibold text-gray-700">ğŸ“– <span id="main-pdf-info">Selecione um livro</span></h3>
                        <div class="flex gap-2">
                            <select id="book-selector" class="text-sm border border-gray-300 rounded px-2 py-1">
                                <option value="">Selecione o Livro</option>
                                <option value="0">Livro 1</option>
                                <option value="1">Livro 2</option>
                            </select>
                            <button id="prev-page-main" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">â€¹ Ant</button>
                            <span id="page-info-main" class="text-xs text-gray-600">-</span>
                            <button id="next-page-main" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">Prox â€º</button>
                        </div>
                    </div>
                    <div class="p-2 flex flex-col" style="height: 70vh;">
                        <canvas id="main-pdf-canvas" class="border rounded flex-1 w-full"></canvas>
                        <div id="main-pdf-loading" class="text-center py-4 text-gray-500 text-sm">
                            ğŸ“„ Aguardando carregamento do PDF...
                        </div>
                    </div>
                </div>
                
                <!-- Ãrea dos Controles (50%) -->
                <div class="w-1/2 flex flex-col">
                    <div id="books-list" class="space-y-3 flex-1 overflow-y-auto" style="height: 75vh;"></div>
                </div>
            </div>
        </div>

        <!-- Tela de Detalhes do CapÃ­tulo -->
        <div id="chapter-screen" class="hidden">
             <div class="mb-4">
                 <button id="back-button" class="text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out">&larr; Voltar</button>
                 <h1 id="chapter-title" class="text-xl md:text-2xl font-bold mb-2 text-gray-800"></h1>
                 <div class="mb-4">
                     <div class="progress-bar-bg"><div id="progress-bar-chapter-detail" class="progress-bar-fill"></div></div>
                     <p id="progress-text-chapter-detail" class="text-right text-sm font-medium text-gray-600 mt-1">0%</p>
                 </div>
             </div>
             
             <!-- BotÃµes de aÃ§Ã£o -->
             <div class="mb-4 flex gap-2 flex-wrap">
                 <button id="show-pdf-button" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm transition">
                     ğŸ“– <span class="hidden sm:inline">Ver</span> PDF
                 </button>
                 <button id="toggle-annotations-button" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm transition">
                     ğŸ“ <span class="hidden sm:inline">AnotaÃ§Ãµes</span>
                 </button>
                 <button id="hide-pdf-button" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded text-sm transition">
                     âœ• <span class="hidden sm:inline">Fechar PDF</span>
                 </button>
             </div>
             
             <!-- Layout dividido: PDF + Controles -->
             <div id="split-layout" class="hidden">
                 <!-- Container flex para proporÃ§Ã£o 70%/30% -->
                 <div class="flex flex-col lg:flex-row h-screen lg:h-auto gap-2">
                     <!-- Ãrea do PDF (70% da largura) -->
                     <div id="pdf-section" class="w-full lg:w-7/10 flex-shrink-0" style="width: 70%;">
                         <div class="bg-white rounded-lg shadow border border-gray-200 h-full">
                             <div class="p-2 border-b border-gray-200 flex justify-between items-center">
                                 <h3 class="text-sm font-semibold text-gray-700">ğŸ“– <span id="pdf-chapter-info"></span></h3>
                                 <div class="flex gap-1">
                                     <button id="prev-page" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">â€¹ Ant</button>
                                     <span id="page-info" class="text-xs text-gray-600"></span>
                                     <button id="next-page" class="text-gray-500 hover:text-gray-700 px-2 py-1 text-xs">Prox â€º</button>
                                 </div>
                             </div>
                             <div class="p-1 h-full flex flex-col">
                                 <canvas id="pdf-canvas" class="border rounded flex-1 w-full" style="max-height: 80vh; min-height: 500px;"></canvas>
                                 <div id="pdf-loading" class="text-center py-2 text-gray-500 text-sm hidden">
                                     ğŸ“„ Carregando pÃ¡gina...
                                 </div>
                             </div>
                         </div>
                     </div>
                     
                     <!-- Ãrea dos controles (30% da largura) -->
                     <div id="controls-section" class="w-full lg:w-3/10 flex-shrink-0 flex flex-col" style="width: 30%;">
                         <!-- Painel de AnotaÃ§Ãµes -->
                         <div id="annotations-panel" class="mb-2 bg-white rounded-lg shadow border border-gray-200 flex-shrink-0">
                             <div class="p-2 border-b border-gray-200">
                                 <h3 class="text-sm font-semibold text-gray-700">ğŸ“ AnotaÃ§Ãµes do CapÃ­tulo</h3>
                             </div>
                             <div class="p-2">
                                 <textarea id="chapter-annotations" class="w-full h-16 p-2 border border-gray-300 rounded-md resize-none text-xs" 
                                           placeholder="Digite suas anotaÃ§Ãµes sobre este capÃ­tulo..."></textarea>
                                 <div class="mt-1 text-xs text-gray-500">ğŸ’¾ Salvas automaticamente</div>
                             </div>
                         </div>
                         
                         <!-- ConteÃºdo do checklist -->
                         <div id="chapter-content-split" class="bg-white rounded-lg shadow border border-gray-200 flex-1 overflow-y-auto">
                             <div class="p-2 border-b border-gray-200">
                                 <h3 class="text-sm font-semibold text-gray-700">ğŸ“‹ Checklist do CapÃ­tulo</h3>
                             </div>
                             <div class="p-2 space-y-2">
                                 <!-- ConteÃºdo serÃ¡ gerado aqui -->
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
             
             <!-- Layout tradicional (quando PDF nÃ£o estÃ¡ visÃ­vel) -->
             <div id="traditional-layout">
                 <div id="chapter-content" class="bg-white p-4 rounded-lg shadow space-y-4 border border-gray-200">
                     <!-- ConteÃºdo do checklist Ã© gerado aqui -->
                 </div>
             </div>
        </div>
    </div>

    <!-- Script Principal do Checklist -->
    <script>
        console.log('ğŸš€ CÃ“DIGO JAVASCRIPT CARREGADO - VERSÃƒO COM LAYOUT DIVIDIDO - REDEPLOY');
        console.log('ğŸ• Timestamp:', new Date().toISOString());
        console.log('ğŸ“… Deploy forÃ§ado:', 'Force cache bust');
        
        // --- Mapeamento de PÃ¡ginas dos CapÃ­tulos ---
        const chapterPageMapping = {
            0: { // Livro 1
                0: { startPage: 1, endPage: 15 },    // IntroduÃ§Ã£o
                1: { startPage: 16, endPage: 30 },   // ä½ æ˜¯å·´è¥¿äººå—?
                2: { startPage: 31, endPage: 45 },   // ä½ æœ‰ä¹¦å—?
                3: { startPage: 46, endPage: 60 },   // ä»–ä»¬æ˜¯è°?
                4: { startPage: 61, endPage: 75 },   // ä½ å­¦ä¹ æ±‰è¯­å—?
                5: { startPage: 76, endPage: 90 },   // ä»Šå¤©å‡ æœˆå‡ å·?
                6: { startPage: 91, endPage: 105 },  // ä½ å‡ ç‚¹èµ·åºŠ?
                7: { startPage: 106, endPage: 120 }, // è¯·é—®,å­¦æ ¡åœ¨å“ªé‡Œ?
                8: { startPage: 121, endPage: 135 }  // ä½ çš„æˆ¿é—´é‡Œæœ‰ä»€ä¹ˆ?
            },
            1: { // Livro 2  
                9: { startPage: 1, endPage: 15 },    // ä½ æƒ³å–ä»€ä¹ˆ?
                10: { startPage: 16, endPage: 30 },  // è¿™ä¸ªå¤šå°‘é’±?
                11: { startPage: 31, endPage: 45 },  // æˆ‘å»ä¹°ä¸œè¥¿
                12: { startPage: 46, endPage: 60 },  // æˆ‘ä»¬æ€ä¹ˆå»ä»–çš„å®¶?
                13: { startPage: 61, endPage: 75 },  // æˆ‘è·Ÿæœ‹å‹ä¸€èµ·åƒåˆé¥­
                14: { startPage: 76, endPage: 90 },  // å¥¹ä¸èƒ½å»,å¥¹è¦ä¼‘æ¯
                15: { startPage: 91, endPage: 105 }, // ä»è¿™é‡Œåˆ°é•¿åŸæ€ä¹ˆå»?
                16: { startPage: 106, endPage: 120 } // ä½ åœ¨åšä»€ä¹ˆå‘¢?
            }
        };

        // --- Estrutura de Dados do Checklist (Inalterada) ---
        const checklistData = [
            // ... (toda a estrutura de dados completa, como na versÃ£o anterior) ...
             {
            livro: 1,
            tituloLivro: "Livro 1",
            capitulos: [
              {
                capitulo: 0,
                tituloCapitulo: "IntroduÃ§Ã£o",
                subtopicos: {
                  topicos: [
                    { id: "l1c0t1", texto: "IntroduÃ§Ã£o ao Pinyin (Iniciais, Finais, Tons)", concluido: false },
                    { id: "l1c0t2", texto: "Regras de pronÃºncia e mudanÃ§as de tom", concluido: false },
                    { id: "l1c0t3", texto: "Estrutura bÃ¡sica dos caracteres chineses (Hanzi)", concluido: false },
                    { id: "l1c0t4", texto: "Ordem dos traÃ§os", concluido: false },
                  ]
                }
              },
              {
                capitulo: 1,
                tituloCapitulo: "ä½ æ˜¯å·´è¥¿äººå—?",
                subtopicos: {
                  dialogos: [
                    { id: "l1c1d1", texto: "DiÃ¡logo 1 (Paulo e Xiaolong se conhecem)", concluido: false },
                    { id: "l1c1d2", texto: "DiÃ¡logo 2 (Professora Li e Lia)", concluido: false },
                    { id: "l1c1d3", texto: "ApresentaÃ§Ã£o (Thiago e Lucas)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c1v1", texto: "VocabulÃ¡rio 1: Cumprimentos (ä½ å¥½), pronomes (ä½ , æˆ‘), chamar-se (å«), ser (æ˜¯), nacionalidades (ä¸­å›½äºº, å·´è¥¿äºº), pergunta (å—), nÃ£o (ä¸), tambÃ©m (ä¹Ÿ)", concluido: false },
                    { id: "l1c1v2", texto: "VocabulÃ¡rio 2: Tratamento formal (æ‚¨), profissÃµes (è€å¸ˆ, å­¦ç”Ÿ), paÃ­ses (ç¾å›½, è‹±å›½), pronomes (ä»–, å¥¹, ä»¬)", concluido: false },
                    { id: "l1c1v3", texto: "VocabulÃ¡rio 3: Taiwan (å°æ¹¾), agradecer (è°¢è°¢)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c1g1", texto: "Estrutura bÃ¡sica da frase", concluido: false },
                    { id: "l1c1g2", texto: "Uso do verbo æ˜¯ (ser)", concluido: false },
                    { id: "l1c1g3", texto: "Formando perguntas com å—", concluido: false },
                    { id: "l1c1g4", texto: "NegaÃ§Ã£o com ä¸", concluido: false },
                    { id: "l1c1g5", texto: "Uso do advÃ©rbio ä¹Ÿ (tambÃ©m)", concluido: false },
                    { id: "l1c1g6", texto: "Pronomes e plural com ä»¬", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c1e1", texto: "ExercÃ­cio: Completar frases com æ˜¯", concluido: false },
                    { id: "l1c1e2", texto: "ExercÃ­cio: Formular perguntas com å—", concluido: false },
                    { id: "l1c1e3", texto: "ExercÃ­cio: Transformar frases (afirmaÃ§Ã£o, negaÃ§Ã£o, pergunta)", concluido: false },
                    { id: "l1c1e4", texto: "ExercÃ­cio: Completar diÃ¡logo", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c1h1", texto: "PrÃ¡tica de Hanzi: ä½ , å¥½, æˆ‘, å«, æ˜¯, ä¸­, å›½, äºº, å—, ä¹Ÿ, ä¸, å·´, è¥¿, å­¦, ç”Ÿ, è€, å¸ˆ, æ‚¨, ç¾, è‹±, ä»–, å¥¹, ä»¬, å°, æ¹¾, è°¢", concluido: false }
                  ]
                }
              },
               {
                capitulo: 2,
                tituloCapitulo: "ä½ æœ‰ä¹¦å—?",
                subtopicos: {
                  dialogos: [
                    { id: "l1c2d1", texto: "DiÃ¡logo 1 (Professora Li e Paulo - materiais)", concluido: false },
                    { id: "l1c2d2", texto: "DiÃ¡logo 2 (Paulo mostra a casa para Lia)", concluido: false },
                    { id: "l1c2d3", texto: "Texto (Professora Li descreve sua casa)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c2v1", texto: "VocabulÃ¡rio 1: Ter (æœ‰), nÃ£o ter (æ²’æœ‰), objetos (ä¹¦, ç¬”, é“…ç¬”, åœ°å›¾)", concluido: false },
                    { id: "l1c2v2", texto: "VocabulÃ¡rio 2: Este/Isto (è¿™), posse (çš„), casa/famÃ­lia (å®¶), bem-vindo (æ¬¢è¿), TV (ç”µè§†), computador (ç”µè„‘), um (ä¸€), medida geral (ä¸ª)", concluido: false },
                    { id: "l1c2v3", texto: "VocabulÃ¡rio 3: Dois (ä¸¤/äºŒ), 3-5 (ä¸‰, å››, äº”), medidas (æ”¯, æœ¬, å¼ )", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c2g1", texto: "Uso do verbo æœ‰ / æ²¡æœ‰", concluido: false },
                    { id: "l1c2g2", texto: "PartÃ­cula de posse çš„", concluido: false },
                    { id: "l1c2g3", texto: "Uso de palavras de medida com numerais", concluido: false },
                    { id: "l1c2g4", texto: "DiferenÃ§a entre ä¸¤ e äºŒ", concluido: false }
                  ],
                   exercicios: [
                    { id: "l1c2e1", texto: "ExercÃ­cio: Responder perguntas usando çš„", concluido: false },
                    { id: "l1c2e2", texto: "ExercÃ­cio: Responder perguntas usando æœ‰/æ²¡æœ‰", concluido: false },
                    { id: "l1c2e3", texto: "ExercÃ­cio: Ligar palavras e imagens", concluido: false },
                    { id: "l1c2e4", texto: "ExercÃ­cio: Preencher com palavras de medida", concluido: false },
                    { id: "l1c2e5", texto: "ExercÃ­cio: Transformar frases", concluido: false },
                    { id: "l1c2e6", texto: "ExercÃ­cio: Reorganizar palavras", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c2h1", texto: "PrÃ¡tica de Hanzi: æœ‰, æ²¡, ä¹¦, ç¬”, é“…, åœ°, å›¾, æ¬¢, è¿, è¿™, çš„, å®¶, ç”µ, è§†, è„‘, ä¸€, ä¸ª, ä¸¤, äºŒ, ä¸‰, æ”¯, å››, äº”, æœ¬, å¼ ", concluido: false }
                  ]
                }
              },
               {
                capitulo: 3,
                tituloCapitulo: "ä»–ä»¬æ˜¯è°?",
                 subtopicos: {
                  dialogos: [
                    { id: "l1c3d1", texto: "DiÃ¡logo 1 (Xiaolong mostra foto de famÃ­lia)", concluido: false },
                    { id: "l1c3d2", texto: "DiÃ¡logo 2 (Lia e Marina falam sobre famÃ­lias)", concluido: false },
                    { id: "l1c3d3", texto: "DiÃ¡logo 3 (Professora Li pergunta sobre famÃ­lias)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c3v1", texto: "VocabulÃ¡rio 1: Foto (ç…§ç‰‡), sim (æ˜¯çš„), quem? (è°), famÃ­lia (å®¶äºº), quantos? (å‡ ), medida (å£), pai (çˆ¸çˆ¸), mÃ£e (å¦ˆå¦ˆ), e (å’Œ)", concluido: false },
                    { id: "l1c3v2", texto: "VocabulÃ¡rio 2: O quÃª? (ä»€ä¹ˆ), mÃ©dico (åŒ»ç”Ÿ), irmÃ£o mais velho (å“¥å“¥), fazer (åš), trabalho (å·¥ä½œ), irmÃ£ mais velha (å§å§), irmÃ£ mais nova (å¦¹å¦¹)", concluido: false },
                    { id: "l1c3v3", texto: "VocabulÃ¡rio 3: IrmÃ£o mais novo (å¼Ÿå¼Ÿ)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c3g1", texto: "Perguntar 'quem?' com è°", concluido: false },
                    { id: "l1c3g2", texto: "Perguntar 'quantos?' (poucos) com å‡ ", concluido: false },
                    { id: "l1c3g3", texto: "Perguntar 'o quÃª?' com ä»€ä¹ˆ", concluido: false },
                    { id: "l1c3g4", texto: "Uso da medida å£ para famÃ­lia", concluido: false },
                    { id: "l1c3g5", texto: "Perguntar a profissÃ£o (åšä»€ä¹ˆå·¥ä½œ)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c3e1", texto: "ExercÃ­cio: Formular perguntas com ä»€ä¹ˆ, å‡ , è°", concluido: false },
                    { id: "l1c3e2", texto: "ExercÃ­cio: Responder perguntas pessoais", concluido: false },
                    { id: "l1c3e3", texto: "ExercÃ­cio: Leitura e interpretaÃ§Ã£o", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c3h1", texto: "PrÃ¡tica de Hanzi: ç…§, ç‰‡, æ˜¯, çš„, è°, å®¶, äºº, å‡ , å£, çˆ¸, å¦ˆ, å’Œ, ä»€, ä¹ˆ, åŒ», ç”Ÿ, å“¥, åš, å·¥, ä½œ, å§, å¦¹, å¼Ÿ", concluido: false }
                  ]
                }
              },
              {
                capitulo: 4,
                tituloCapitulo: "ä½ å­¦ä¹ æ±‰è¯­å—?",
                subtopicos: {
                   dialogos: [
                    { id: "l1c4d1", texto: "DiÃ¡logo 1 (Marina e Xiaolong - nacionalidade, estudos)", concluido: false },
                    { id: "l1c4d2", texto: "DiÃ¡logo 2 (Lia e Paulo - turmas)", concluido: false },
                    { id: "l1c4d3", texto: "DiÃ¡logo 3 (Marina recebe Lia e Paulo)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l1c4v1", texto: "VocabulÃ¡rio 1: Nome (åå­—), qual? (å“ª), paÃ­s (å›½), estudar (å­¦ä¹ /å­¦), Mandarim (æ±‰è¯­), correto (å¯¹), InglÃªs (è‹±è¯­), PortuguÃªs (è‘¡è„ç‰™è¯­), difÃ­cil (éš¾)", concluido: false },
                    { id: "l1c4v2", texto: "VocabulÃ¡rio 2: Turma (ç­), todos (éƒ½), estrangeiro (å¤–å›½/å¤–å›½äºº), quantos? (å¤šå°‘), menino/aluno (ç”·ç”Ÿ), menina/aluna (å¥³ç”Ÿ), 6-10 (å…­, ä¸ƒ, å…«, ä¹, å)", concluido: false },
                    { id: "l1c4v3", texto: "VocabulÃ¡rio 3: Amigo (æœ‹å‹), colega (åŒå­¦)", concluido: false }
                  ],
                   gramatica: [
                    { id: "l1c4g1", texto: "Perguntar 'qual paÃ­s?' com å“ªå›½", concluido: false },
                    { id: "l1c4g2", texto: "Uso de å¤šå°‘ vs å‡ ", concluido: false },
                    { id: "l1c4g3", texto: "Uso do advÃ©rbio éƒ½ (todos)", concluido: false },
                    { id: "l1c4g4", texto: "Estrutura ä¸éƒ½ (nem todos)", concluido: false },
                    { id: "l1c4g5", texto: "FormaÃ§Ã£o de nÃºmeros 11-99", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c4e1", texto: "ExercÃ­cio: Ouvir e escrever nÃºmeros", concluido: false },
                    { id: "l1c4e2", texto: "ExercÃ­cio: InterpretaÃ§Ã£o de texto (alunos)", concluido: false },
                    { id: "l1c4e3", texto: "ExercÃ­cio: Escrever nÃºmeros em caracteres", concluido: false },
                    { id: "l1c4e4", texto: "ExercÃ­cio: Fazer perguntas com å‡  / å¤šå°‘", concluido: false },
                    { id: "l1c4e5", texto: "ExercÃ­cio: Responder perguntas pessoais", concluido: false }
                  ],
                   hanzi: [
                    { id: "l1c4h1", texto: "PrÃ¡tica de Hanzi: å, å­—, å“ª, å›½, å­¦, ä¹ , æ±‰, è¯­, å¯¹, è‹±, è‘¡, è„, ç‰™, éš¾, ç­, éƒ½, å¤–, å¤š, å°‘, ç”·, å¥³, ç”Ÿ, å…­, ä¸ƒ, å…«, ä¹, å, æœ‹, å‹, åŒ", concluido: false }
                  ]
                }
              },
               {
                capitulo: 5,
                tituloCapitulo: "ä»Šå¤©å‡ æœˆå‡ å·?",
                subtopicos: {
                   dialogos: [
                    { id: "l1c5d1", texto: "DiÃ¡logo 1 (Lia parabeniza Marina)", concluido: false },
                    { id: "l1c5d2", texto: "DiÃ¡logo 2 (Paulo e Xiaolong - aniversÃ¡rios)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l1c5v1", texto: "VocabulÃ¡rio 1: AlÃ´ (å–‚), muito (å¾ˆ), hoje (ä»Šå¤©), dia (å¤©), aniversÃ¡rio (ç”Ÿæ—¥), desejar (ç¥), feliz (å¿«ä¹), de nada (ä¸è°¢), amanhÃ£ (æ˜å¤©), ontem (æ˜¨å¤©), dar presente (é€), presente (ç¤¼ç‰©), feliz/contente (é«˜å…´)", concluido: false },
                    { id: "l1c5v2", texto: "VocabulÃ¡rio 2: MÃªs (æœˆ), dia (å·/æ—¥), semana (æ˜ŸæœŸ/ç¤¼æ‹œ), dias da semana (æ˜ŸæœŸä¸€ a æ—¥), idade (å²)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c5g1", texto: "Formular datas (MÃªs + Dia)", concluido: false },
                    { id: "l1c5g2", texto: "Perguntar data (å‡ æœˆå‡ å·)", concluido: false },
                    { id: "l1c5g3", texto: "Perguntar dia da semana (æ˜ŸæœŸå‡ )", concluido: false },
                    { id: "l1c5g4", texto: "Perguntar idade (å‡ å²)", concluido: false },
                    { id: "l1c5g5", texto: "Expressar votos (ç¥ä½ ç”Ÿæ—¥å¿«ä¹)", concluido: false }
                  ],
                  exercicios: [
                     { id: "l1c5e1", texto: "ExercÃ­cio: Responder perguntas (datas, dias da semana)", concluido: false },
                     { id: "l1c5e2", texto: "ExercÃ­cio: Responder perguntas (aniversÃ¡rios, idade)", concluido: false },
                     { id: "l1c5e3", texto: "ExercÃ­cio: Completar diÃ¡logo (aniversÃ¡rio)", concluido: false }
                  ],
                  hanzi: [
                     { id: "l1c5h1", texto: "PrÃ¡tica de Hanzi: å–‚, å¾ˆ, ä»Š, å¤©, ç”Ÿ, æ—¥, ç¥, å¿«, ä¹, ä¸, è°¢, æ˜, é€, ç¤¼, ç‰©, é«˜, å…´, æœˆ, å·, æ˜Ÿ, æœŸ, å², ä¸€, äºŒ, ä¸‰, å››, äº”, å…­", concluido: false }
                  ]
                }
              },
              {
                capitulo: 6,
                tituloCapitulo: "ä½ å‡ ç‚¹èµ·åºŠ?",
                 subtopicos: {
                   dialogos: [
                    { id: "l1c6d1", texto: "DiÃ¡logo 1 (Xiaolong pergunta horas ao pai)", concluido: false },
                    { id: "l1c6d2", texto: "DiÃ¡logo 2 (Professora Li e Marina - rotina)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l1c6v1", texto: "VocabulÃ¡rio 1: Agora (ç°åœ¨), hora (ç‚¹), zero (é›¶), minuto (åˆ†), por quÃª? (ä¸ºä»€ä¹ˆ), manhÃ£ cedo (æ—©ä¸Š), metade/meia (åŠ), comeÃ§ar/terminar aula (ä¸Šè¯¾/ä¸‹è¯¾), de manhÃ£ (ä¸Šåˆ), quarto de hora (åˆ»)", concluido: false },
                    { id: "l1c6v2", texto: "VocabulÃ¡rio 2: Acordar (èµ·åºŠ), momento (æ—¶å€™), quando? (ä»€ä¹ˆæ—¶å€™), meio-dia (ä¸­åˆ), Ã  tarde (ä¸‹åˆ), ver/assistir/ler (çœ‹/çœ‹ä¹¦), Ã  noite (æ™šä¸Š), dormir (ç¡è§‰)", concluido: false }
                  ],
                  gramatica: [
                     { id: "l1c6g1", texto: "Expressar horas e minutos", concluido: false },
                     { id: "l1c6g2", texto: "Uso de åŠ (meia hora) e åˆ» (quarto de hora)", concluido: false },
                     { id: "l1c6g3", texto: "Perguntar horas (å‡ ç‚¹)", concluido: false },
                     { id: "l1c6g4", texto: "Perguntar 'quando?' (ä»€ä¹ˆæ—¶å€™)", concluido: false },
                     { id: "l1c6g5", texto: "DivisÃµes do dia (æ—©ä¸Š, ä¸Šåˆ, ä¸­åˆ, ä¸‹åˆ, æ™šä¸Š)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c6e1", texto: "ExercÃ­cio: Dizer as horas", concluido: false },
                    { id: "l1c6e2", texto: "ExercÃ­cio: Responder perguntas (rotina, horÃ¡rios)", concluido: false },
                    { id: "l1c6e3", texto: "ExercÃ­cio: Ouvir e ordenar horÃ¡rios", concluido: false },
                    { id: "l1c6e4", texto: "ExercÃ­cio: Completar diÃ¡logo (horas)", concluido: false }
                  ],
                  hanzi: [
                     { id: "l1c6h1", texto: "PrÃ¡tica de Hanzi: ç°, åœ¨, ç‚¹, é›¶, åˆ†, ä¸º, ä»€, ä¹ˆ, æ—©, ä¸Š, åŠ, è¯¾, ä¸‹, åˆ, åˆ», èµ·, åºŠ, æ—¶, å€™, ä¸­, çœ‹, ä¹¦, æ™š, ç¡, è§‰", concluido: false }
                  ]
                 }
              },
               {
                capitulo: 7,
                tituloCapitulo: "è¯·é—®,å­¦æ ¡åœ¨å“ªé‡Œ?",
                 subtopicos: {
                   dialogos: [
                    { id: "l1c7d1", texto: "DiÃ¡logo 1 (Lia indica caminho da escola)", concluido: false },
                    { id: "l1c7d2", texto: "DiÃ¡logo 2 (Paulo pede informaÃ§Ã£o a policial)", concluido: false },
                    { id: "l1c7d3", texto: "ApresentaÃ§Ã£o (Yaoming descreve arredores)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c7v1", texto: "VocabulÃ¡rio 1: Escola (å­¦æ ¡), estar em (åœ¨), onde? (å“ªé‡Œ), frente (å‰é¢/å‰è¾¹), com fome (é¥¿), ao lado (æ—è¾¹), restaurante (é¥­é¦†), atrÃ¡s (åé¢/åè¾¹), banco (é“¶è¡Œ), oeste (è¥¿è¾¹), leste (ä¸œè¾¹)", concluido: false },
                    { id: "l1c7v2", texto: "VocabulÃ¡rio 2: Com licenÃ§a (è¯·é—®), aquele (é‚£), lugar (åœ°æ–¹), medida prÃ©dios (åº§), prÃ©dio (æ¥¼), hospital (åŒ»é™¢), norte (åŒ—è¾¹), sul (å—è¾¹), livraria (ä¹¦åº—), loja (åº—), de nada (ä¸å®¢æ°”)", concluido: false },
                    { id: "l1c7v3", texto: "VocabulÃ¡rio 3: Conhecer (è®¤è¯†)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c7g1", texto: "Uso de åœ¨ para localizaÃ§Ã£o", concluido: false },
                    { id: "l1c7g2", texto: "Perguntar 'onde?' com åœ¨å“ªé‡Œ", concluido: false },
                    { id: "l1c7g3", texto: "Palavras de localizaÃ§Ã£o (pontos cardeais, posiÃ§Ãµes)", concluido: false },
                    { id: "l1c7g4", texto: "Uso de è¯·é—®", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c7e1", texto: "ExercÃ­cio: Descrever localizaÃ§Ãµes (imagens)", concluido: false },
                    { id: "l1c7e2", texto: "ExercÃ­cio: Responder perguntas (direÃ§Ãµes)", concluido: false },
                    { id: "l1c7e3", texto: "ExercÃ­cio: Responder perguntas (localizaÃ§Ã£o)", concluido: false },
                    { id: "l1c7e4", texto: "ExercÃ­cio: Fazer perguntas (interrogativos)", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c7h1", texto: "PrÃ¡tica de Hanzi: å­¦, æ ¡, åœ¨, å“ª, é‡Œ, å‰, è¾¹, é¢, é¥¿, æ—, é¥­, é¦†, å, é“¶, è¡Œ, è¥¿, ä¸œ, è¯·, é—®, é‚£, ä¸ª, åœ°, æ–¹, åº§, æ¥¼, åŒ», é™¢, åŒ—, å—, ä¹¦, åº—, ä¸, å®¢, æ°”, è®¤, è¯†", concluido: false }
                  ]
                }
              },
               {
                capitulo: 8,
                tituloCapitulo: "ä½ çš„æˆ¿é—´é‡Œæœ‰ä»€ä¹ˆ?",
                 subtopicos: {
                   dialogos: [
                    { id: "l1c8d1", texto: "DiÃ¡logo 1 (Yaoming visita quarto de Lia)", concluido: false },
                    { id: "l1c8d2", texto: "DiÃ¡logo 2 (Xiaolong visita quarto de Paulo - animais)", concluido: false },
                    { id: "l1c8d3", texto: "Texto (Professora Li descreve seu quarto)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l1c8v1", texto: "VocabulÃ¡rio 1: Bonito (æ¼‚äº®), quarto (æˆ¿é—´), dentro (é‡Œ/é‡Œè¾¹), mesa (æ¡Œå­), cama (åºŠ), medida (æŠŠ), cadeira (æ¤…å­), estante (ä¹¦æ¶), fora (å¤–/å¤–è¾¹)", concluido: false },
                    { id: "l1c8v2", texto: "VocabulÃ¡rio 2: Esquerda (å·¦/å·¦è¾¹), direita (å³/å³è¾¹), medida (åª), cachorro (ç‹—), gato (çŒ«), cima (ä¸Š/ä¸Šè¾¹), partÃ­cula (å‘¢), baixo (ä¸‹/ä¸‹è¾¹)", concluido: false },
                    { id: "l1c8v3", texto: "VocabulÃ¡rio 3: Meio/Entre (ä¸­é—´)", concluido: false }
                  ],
                  gramatica: [
                    { id: "l1c8g1", texto: "Palavras de localizaÃ§Ã£o detalhadas", concluido: false },
                    { id: "l1c8g2", texto: "Estrutura 'Local + Verbo + Objeto'", concluido: false },
                    { id: "l1c8g3", texto: "Uso da partÃ­cula å‘¢ (retomar pergunta)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l1c8e1", texto: "ExercÃ­cio: Responder perguntas (prÃ³prio quarto)", concluido: false },
                    { id: "l1c8e2", texto: "ExercÃ­cio: Descrever localizaÃ§Ãµes (imagens)", concluido: false },
                    { id: "l1c8e3", texto: "ExercÃ­cio: Preencher com palavras de medida", concluido: false },
                    { id: "l1c8e4", texto: "ExercÃ­cio: Reorganizar palavras", concluido: false }
                  ],
                  hanzi: [
                    { id: "l1c8h1", texto: "PrÃ¡tica de Hanzi: æ¼‚, äº®, æˆ¿, é—´, é‡Œ, è¾¹, æ¡Œ, å­, åºŠ, æŠŠ, æ¤…, ä¹¦, æ¶, å¤–, å·¦, å³, åª, ç‹—, çŒ«, ä¸Š, å‘¢, ä¸‹, ä¸­", concluido: false }
                  ]
                 }
              }
            ]
          },
          {
            livro: 2,
            tituloLivro: "Livro 2",
            capitulos: [
              {
                capitulo: 9,
                tituloCapitulo: "ä½ æƒ³å–ä»€ä¹ˆ?",
                 subtopicos: {
                   dialogos: [
                    { id: "l2c9d1", texto: "DiÃ¡logo 1 (Marina oferece bebida a Lia)", concluido: false },
                    { id: "l2c9d2", texto: "DiÃ¡logo 2 (Paulo no restaurante chinÃªs)", concluido: false },
                    { id: "l2c9d3", texto: "DiÃ¡logo 3 (Xiaolong convida Marina)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l2c9v1", texto: "VocabulÃ¡rio 1: å¥½ä¹…ä¸è§, å, æƒ³, å–, å’–å•¡, è¿˜æ˜¯, èŒ¶, æ°´, è¡Œ", concluido: false },
                    { id: "l2c9v2", texto: "VocabulÃ¡rio 2: ä½, åƒ, æŠ«è¨, è¿™é‡Œ, èœ, ç‚’é¢, ç±³é¥­, é¥ºå­, åŒ…å­", concluido: false },
                    { id: "l2c9v3", texto: "VocabulÃ¡rio 3: å•¤é…’, å§, å¯¹ä¸èµ·, ä¸è¡Œ", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c9g1", texto: "Uso de æƒ³ (gostaria)", concluido: false },
                    { id: "l2c9g2", texto: "Perguntas com è¿˜æ˜¯ (ou)", concluido: false },
                    { id: "l2c9g3", texto: "Perguntas afirmativo-negativas", concluido: false },
                    { id: "l2c9g4", texto: "Uso da partÃ­cula å§ (sugestÃ£o)", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c9e1", texto: "ExercÃ­cio: Formular perguntas com è¿˜æ˜¯", concluido: false },
                    { id: "l2c9e2", texto: "ExercÃ­cio: Criar perguntas afirmativo-negativas", concluido: false },
                    { id: "l2c9e3", texto: "ExercÃ­cio: Reformular perguntas (...å—? -> afirm-neg)", concluido: false },
                    { id: "l2c9e4", texto: "ExercÃ­cio: Reformular perguntas (...ä»€ä¹ˆ? -> ...è¿˜æ˜¯...)", concluido: false }
                  ],
                   hanzi: [
                    { id: "l2c9h1", texto: "PrÃ¡tica de Hanzi: å¥½, ä¹…, ä¸, è§, å, æƒ³, å–, å’–, å•¡, è¿˜, æ˜¯, èŒ¶, æ°´, è¡Œ, ä½, åƒ, æŠ«, è¨, è¿™, é‡Œ, èœ, ç‚’, é¢, ç±³, é¥­, é¥º, å­, åŒ…, å•¤, é…’, å§, å¯¹, èµ·", concluido: false }
                  ]
                }
              },
               {
                capitulo: 10,
                tituloCapitulo: "è¿™ä¸ªå¤šå°‘é’±?",
                 subtopicos: {
                  dialogos: [
                    { id: "l2c10d1", texto: "DiÃ¡logo 1 (Lia compra frutas)", concluido: false },
                    { id: "l2c10d2", texto: "DiÃ¡logo 2 (Paulo compra lanche)", concluido: false },
                    { id: "l2c10d3", texto: "DiÃ¡logo 3 (Xiaolong pechincha)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l2c10v1", texto: "VocabulÃ¡rio 1: è¦, ä¹°, æ–¤, å…¬æ–¤, è‹¹æœ, é¦™è•‰, ç§, é’±, å¤šå°‘é’±, å—/å…ƒ, æ¯›/è§’, åˆ†", concluido: false },
                    { id: "l2c10v2", texto: "VocabulÃ¡rio 2: æ¯, å¤§, å°, è¿˜, åˆ«çš„, ä¸€å…±, ç»™, æ‰¾", concluido: false },
                    { id: "l2c10v3", texto: "VocabulÃ¡rio 3: å¤ª...äº†, è´µ, ä¾¿å®œ, ä¸€ç‚¹, æ€ä¹ˆæ ·", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c10g1", texto: "Perguntar preÃ§o (å¤šå°‘é’±)", concluido: false },
                    { id: "l2c10g2", texto: "Estrutura å¤ª + Adj + äº†", concluido: false },
                    { id: "l2c10g3", texto: "ExpressÃµes para pechinchar", concluido: false },
                    { id: "l2c10g4", texto: "Uso de è¿˜ (ainda/alÃ©m disso)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c10e1", texto: "ExercÃ­cio: Escrever preÃ§os", concluido: false },
                    { id: "l2c10e2", texto: "ExercÃ­cio: Calcular preÃ§os", concluido: false },
                    { id: "l2c10e3", texto: "ExercÃ­cio: Responder perguntas (preÃ§os)", concluido: false },
                    { id: "l2c10e4", texto: "ExercÃ­cio: Completar frases (compras)", concluido: false }
                  ],
                  hanzi: [
                     { id: "l2c10h1", texto: "PrÃ¡tica de Hanzi: è¦, ä¹°, æ–¤, å…¬, è‹¹, æœ, é¦™, è•‰, ç§, é’±, å¤š, å°‘, å—, å…ƒ, æ¯›, è§’, åˆ†, æ¯, å¤§, å°, è¿˜, åˆ«, çš„, ä¸€, å…±, ç»™, æ‰¾, å¤ª, äº†, è´µ, ä¾¿, å®œ, ç‚¹, æ€, ä¹ˆ, æ ·", concluido: false }
                  ]
                }
              },
              {
                capitulo: 11,
                tituloCapitulo: "æˆ‘å»ä¹°ä¸œè¥¿",
                 subtopicos: {
                   dialogos: [
                    { id: "l2c11d1", texto: "DiÃ¡logo 1 (Yaoming e Paulo combinam supermercado)", concluido: false },
                    { id: "l2c11d2", texto: "DiÃ¡logo 2 (Lia e Marina apÃ³s aula)", concluido: false },
                    { id: "l2c11d3", texto: "DiÃ¡logo 3 (Marina troca dinheiro)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c11v1", texto: "VocabulÃ¡rio 1: å¿™, æœ‰ç©º, å», è¶…å¸‚, ä¸œè¥¿, ä½, è¿˜, ç”µè¯, å·ç , å†è§", concluido: false },
                    { id: "l2c11v2", texto: "VocabulÃ¡rio 2: å›, æ¢, æ¢é’±, æ¥, ç©", concluido: false },
                    { id: "l2c11v3", texto: "VocabulÃ¡rio 3: ç¾å…ƒ, æ¬§å…ƒ, äººæ°‘å¸, å·´å¸, ç™¾, åƒ, ä¸‡", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c11g1", texto: "Verbos de direÃ§Ã£o å», æ¥, å›", concluido: false },
                    { id: "l2c11g2", texto: "Estrutura Verbo1 + Local + Verbo2", concluido: false },
                    { id: "l2c11g3", texto: "NÃºmeros grandes (centenas, milhares...)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c11e1", texto: "ExercÃ­cio: Formular frases (Verbo1+Local+Verbo2)", concluido: false },
                    { id: "l2c11e2", texto: "ExercÃ­cio: Ligar Hanzi", concluido: false },
                    { id: "l2c11e3", texto: "ExercÃ­cio: Escrever nÃºmeros grandes", concluido: false },
                    { id: "l2c11e4", texto: "ExercÃ­cio: Responder perguntas (rotina)", concluido: false },
                    { id: "l2c11e5", texto: "ExercÃ­cio: Rearrumar palavras", concluido: false },
                    { id: "l2c11e6", texto: "ExercÃ­cio: Formular perguntas (interrogativos)", concluido: false }
                  ],
                  hanzi: [
                    { id: "l2c11h1", texto: "PrÃ¡tica de Hanzi: å¿™, ç©º, æœ‰, å», è¶…, å¸‚, ä¸œ, è¥¿, ä½, è¿˜, ç”µ, è¯, å·, ç , å†, è§, å›, æ¢, é’±, æ¥, ç©, ç¾, å…ƒ, æ¬§, äºº, æ°‘, å¸, å·´, ç™¾, åƒ, ä¸‡", concluido: false }
                  ]
                 }
              },
              {
                capitulo: 12,
                tituloCapitulo: "æˆ‘ä»¬æ€ä¹ˆå»ä»–çš„å®¶?",
                subtopicos: {
                  dialogos: [
                    { id: "l2c12d1", texto: "DiÃ¡logo 1 (Yaoming e Marina planejam ir Ã  casa de Paulo)", concluido: false },
                    { id: "l2c12d2", texto: "DiÃ¡logo 2 (Professora pergunta sobre transporte)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c12v1", texto: "VocabulÃ¡rio 1: å‘¨æœ«, æ€ä¹ˆ, æ±½è½¦, å, å…¬è½¦/å…¬å…±æ±½è½¦, æŒ¤, å¤ªæŒ¤äº†, åœ°é“, ç«™, å‡ºç§Ÿè½¦, é—®é¢˜, æ²¡é—®é¢˜, å‡ºå‘, æ‹œæ‹œ", concluido: false },
                    { id: "l2c12v2", texto: "VocabulÃ¡rio 2: æ¯, æ•™å®¤, éª‘, æ‘©æ‰˜è½¦, è‡ªè¡Œè½¦, èµ°è·¯, å¼€è½¦", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c12g1", texto: "Perguntar 'como?' (transporte) com æ€ä¹ˆå»", concluido: false },
                    { id: "l2c12g2", texto: "Verbos para meios de transporte (å, éª‘, å¼€, èµ°è·¯)", concluido: false },
                    { id: "l2c12g3", texto: "Estrutura S + V(transp) + Meio + V(dir) + Local", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c12e1", texto: "ExercÃ­cio: Formular frases (transporte)", concluido: false },
                    { id: "l2c12e2", texto: "ExercÃ­cio: Ligar Hanzi", concluido: false },
                    { id: "l2c12e3", texto: "ExercÃ­cio: Descrever situaÃ§Ãµes (transporte)", concluido: false },
                    { id: "l2c12e4", texto: "ExercÃ­cio: Rearrumar palavras", concluido: false }
                  ],
                  hanzi: [
                     { id: "l2c12h1", texto: "PrÃ¡tica de Hanzi: å‘¨, æœ«, æ€, ä¹ˆ, æ±½, è½¦, å, å…¬, å…±, æŒ¤, å¤ª, äº†, åœ°, é“, ç«™, å‡º, ç§Ÿ, æ²¡, é—®, é¢˜, å‘, æ‹œ, æ¯, æ•™, å®¤, éª‘, æ‘©, æ‰˜, è‡ª, è¡Œ, èµ°, è·¯, å¼€", concluido: false }
                  ]
                }
              },
              {
                capitulo: 13,
                tituloCapitulo: "æˆ‘è·Ÿæœ‹å‹ä¸€èµ·åƒåˆé¥­",
                 subtopicos: {
                  dialogos: [
                    { id: "l2c13d1", texto: "DiÃ¡logo 1 (Yaoming ajuda Lia)", concluido: false },
                    { id: "l2c13d2", texto: "DiÃ¡logo 2 (ApresentaÃ§Ã£o de Suzuki/Ling Mu)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c13v1", texto: "VocabulÃ¡rio 1: è¿˜å¥½, ä¸€äº›, å¸®, ä¸€ä¸‹, ç”¨, åœ¨, åƒé¥­ (æ—©/åˆ/æ™šé¥­), ä¸€èµ·, é—¨å£, è§é¢", concluido: false },
                    { id: "l2c13v2", texto: "VocabulÃ¡rio 2: ä»‹ç», å¤§å®¶å¥½, æ—¥æœ¬, å›¾ä¹¦é¦†, å†™, ä½œä¸š, æˆ–è€…, è·Ÿ, å¸¸/å¸¸å¸¸, ç»™, æ‰“ç”µè¯, æƒ³ (saudade), èŠå¤©, å‘, çŸ­ä¿¡", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c13g1", texto: "PreposiÃ§Ã£o åœ¨ + Local + Verbo", concluido: false },
                    { id: "l2c13g2", texto: "PreposiÃ§Ã£o è·Ÿ + Pessoa + ä¸€èµ· + Verbo", concluido: false },
                    { id: "l2c13g3", texto: "PreposiÃ§Ã£o ç»™ + Pessoa + Verbo", concluido: false },
                    { id: "l2c13g4", texto: "DiferenÃ§a è¿˜æ˜¯ vs æˆ–è€…", concluido: false },
                    { id: "l2c13g5", texto: "Uso de ä¸€ä¸‹", concluido: false },
                    { id: "l2c13g6", texto: "AdvÃ©rbios de frequÃªncia å¸¸/å¸¸å¸¸", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c13e1", texto: "ExercÃ­cio: Descrever situaÃ§Ãµes com åœ¨", concluido: false },
                    { id: "l2c13e2", texto: "ExercÃ­cio: Descrever situaÃ§Ãµes com è·Ÿ/ç»™", concluido: false },
                    { id: "l2c13e3", texto: "ExercÃ­cio: AudiÃ§Ã£o (Caixa Postal)", concluido: false },
                    { id: "l2c13e4", texto: "ExercÃ­cio: Ligar Hanzi", concluido: false },
                    { id: "l2c13e5", texto: "ExercÃ­cio: Leitura e interpretaÃ§Ã£o", concluido: false },
                    { id: "l2c13e6", texto: "ExercÃ­cio: Rearrumar palavras (preposiÃ§Ãµes)", concluido: false },
                    { id: "l2c13e7", texto: "ExercÃ­cio: Preencher com preposiÃ§Ãµes", concluido: false },
                    { id: "l2c13e8", texto: "ExercÃ­cio: Responder perguntas pessoais", concluido: false }
                  ],
                   hanzi: [
                     { id: "l2c13h1", texto: "PrÃ¡tica de Hanzi: è¿˜, å¥½, ä¸€, äº›, å¸®, ä¸‹, ç”¨, åœ¨, åƒ, é¥­, æ—©, åˆ, æ™š, èµ·, é—¨, å£, è§, é¢, ä»‹, ç», å¤§, å®¶, æ—¥, æœ¬, å›¾, ä¹¦, é¦†, å†™, ä½œ, ä¸š, æˆ–, è€…, è·Ÿ, å¸¸, ç»™, æ‰“, ç”µ, è¯, æƒ³, èŠ, å¤©, å‘, çŸ­, ä¿¡", concluido: false }
                  ]
                }
              },
               {
                capitulo: 14,
                tituloCapitulo: "å¥¹ä¸èƒ½å»,å¥¹è¦ä¼‘æ¯",
                subtopicos: {
                  dialogos: [
                    { id: "l2c14d1", texto: "DiÃ¡logo 1 (Paulo convida Marina - prova)", concluido: false },
                    { id: "l2c14d2", texto: "DiÃ¡logo 2 (Suzuki e Xiaolong - fim de semana)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c14v1", texto: "VocabulÃ¡rio 1: äº‹, å¤ä¹ , æƒ³ (desejo), ç”µå½±, ä¸‹ (prÃ³ximo), ä¸Š (passado), è€ƒè¯•, æ²¡å…³ç³», èˆ’æœ, ä¸èˆ’æœ, èƒ½, è¦ (intenÃ§Ã£o), ä¼‘æ¯", concluido: false },
                    { id: "l2c14v2", texto: "VocabulÃ¡rio 2: å¤§å­¦, ä¸­å­¦, å°å­¦, ä¸€å®š, å“ªé‡Œå“ªé‡Œ, ä¸€èˆ¬, å…¬å›­, è·‘æ­¥, æœ‰æ—¶å€™, å“å‘€", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c14g1", texto: "Verbos modais æƒ³ (desejo), è¦ (intenÃ§Ã£o), èƒ½ (habilidade/permissÃ£o)", concluido: false },
                    { id: "l2c14g2", texto: "DiferenÃ§a æƒ³ vs è¦", concluido: false },
                    { id: "l2c14g3", texto: "AdvÃ©rbios de frequÃªncia ä¸€èˆ¬, æœ‰æ—¶å€™", concluido: false },
                    { id: "l2c14g4", texto: "Uso de ä¸‹ä¸ª / ä¸Šä¸ª", concluido: false }
                  ],
                   exercicios: [
                    { id: "l2c14e1", texto: "ExercÃ­cio: Descrever situaÃ§Ãµes com æƒ³", concluido: false },
                    { id: "l2c14e2", texto: "ExercÃ­cio: Descrever situaÃ§Ãµes com è¦", concluido: false },
                    { id: "l2c14e3", texto: "ExercÃ­cio: Descrever situaÃ§Ãµes com èƒ½", concluido: false },
                    { id: "l2c14e4", texto: "ExercÃ­cio: Ligar Hanzi", concluido: false },
                    { id: "l2c14e5", texto: "ExercÃ­cio: Preencher com verbos modais", concluido: false },
                    { id: "l2c14e6", texto: "ExercÃ­cio: Responder perguntas pessoais", concluido: false }
                  ],
                   hanzi: [
                    { id: "l2c14h1", texto: "PrÃ¡tica de Hanzi: äº‹, å¤, ä¹ , æƒ³, ç”µ, å½±, ä¸‹, ä¸Š, è€ƒ, è¯•, æ²¡, å…³, ç³», èˆ’, æœ, èƒ½, è¦, ä¼‘, æ¯, åŒ—, äº¬, å¤§, å­¦, ä¸­, å°, ä¸€, å®š, å“ª, é‡Œ, èˆ¬, å…¬, å›­, è·‘, æ­¥, æœ‰, æ—¶, å€™, å“, å‘€", concluido: false }
                  ]
                }
              },
               {
                capitulo: 15,
                tituloCapitulo: "ä»è¿™é‡Œåˆ°é•¿åŸæ€ä¹ˆå»?",
                subtopicos: {
                  dialogos: [
                    { id: "l2c15d1", texto: "DiÃ¡logo 1 (Paulo convida Marina Ã  Muralha)", concluido: false },
                    { id: "l2c15d2", texto: "DiÃ¡logo 2 (Marina e Yaoming na Muralha)", concluido: false },
                    { id: "l2c15d3", texto: "Texto (Lia sobre rotina de estudos)", concluido: false }
                  ],
                   vocabulario: [
                    { id: "l2c15v1", texto: "VocabulÃ¡rio 1: æ—¶é—´, é•¿åŸ, ä», åˆ°, çº¿, å’–å•¡åº—, ç­‰", concluido: false },
                    { id: "l2c15v2", texto: "VocabulÃ¡rio 2: ç¬¬, æ¬¡, çœŸçš„, ç»ƒä¹ , å£è¯­, è¯­éŸ³, æ²¡äº‹, èµ°å§, è¯­æ³•, æ±‰å­—", concluido: false },
                    { id: "l2c15v3", texto: "VocabulÃ¡rio 3: å¬, å¯¹è¯, è¯´", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c15g1", texto: "PreposiÃ§Ã£o ä»...åˆ° (lugar)", concluido: false },
                    { id: "l2c15g2", texto: "PreposiÃ§Ã£o ä»...åˆ° (tempo)", concluido: false },
                    { id: "l2c15g3", texto: "NÃºmeros ordinais com ç¬¬", concluido: false },
                    { id: "l2c15g4", texto: "As quatro habilidades (å¬, è¯´, è¯», å†™)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c15e1", texto: "ExercÃ­cio: Descrever percursos com ä»", concluido: false },
                    { id: "l2c15e2", texto: "ExercÃ­cio: Descrever perÃ­odos com ä»...åˆ°", concluido: false },
                    { id: "l2c15e3", texto: "ExercÃ­cio: Leitura e interpretaÃ§Ã£o (rotina)", concluido: false },
                    { id: "l2c15e4", texto: "ExercÃ­cio: Rearrumar palavras (ä»/åˆ°)", concluido: false },
                    { id: "l2c15e5", texto: "ExercÃ­cio: Responder perguntas (rotina, estudos)", concluido: false }
                  ],
                   hanzi: [
                     { id: "l2c15h1", texto: "PrÃ¡tica de Hanzi: æ—¶, é—´, é•¿, åŸ, ä», åˆ°, çº¿, å’–, å•¡, åº—, ç­‰, ç¬¬, æ¬¡, çœŸ, çš„, ç»ƒ, ä¹ , å£, è¯­, éŸ³, æ²¡, äº‹, èµ°, å§, æ³•, æ±‰, å­—, å¬, å¯¹, è¯, è¯´", concluido: false }
                  ]
                }
              },
               {
                capitulo: 16,
                tituloCapitulo: "ä½ åœ¨åšä»€ä¹ˆå‘¢?",
                subtopicos: {
                   dialogos: [
                    { id: "l2c16d1", texto: "DiÃ¡logo 1 (Xiaolong e Paulo - futebol)", concluido: false },
                    { id: "l2c16d2", texto: "DiÃ¡logo 2 (Marina convida Yaoming - ginÃ¡sio)", concluido: false },
                    { id: "l2c16d3", texto: "Texto (Lia apresenta esportes ingleses)", concluido: false }
                  ],
                  vocabulario: [
                    { id: "l2c16v1", texto: "VocabulÃ¡rio 1: åœ¨...å‘¢, åŠ æ²¹, æ‰‹æœº, æ“åœº, è¿åŠ¨, é”»ç‚¼, è¸¢, è¶³çƒ, æ‰“, ç¯®çƒ, ä¸‹æ¬¡, ä¸Šæ¬¡, å•Š", concluido: false },
                    { id: "l2c16v2", texto: "VocabulÃ¡rio 2: æ¯”èµ›, ä½“è‚²é¦†, å–œæ¬¢, æœ‰çš„, æ¸¸æ³³, ç©¿, è¡£æœ", concluido: false }
                  ],
                  gramatica: [
                    { id: "l2c16g1", texto: "Estrutura åœ¨...å‘¢ (presente contÃ­nuo)", concluido: false },
                    { id: "l2c16g2", texto: "NegaÃ§Ã£o do presente contÃ­nuo (æ²¡åœ¨)", concluido: false },
                    { id: "l2c16g3", texto: "Estrutura æœ‰çš„... æœ‰çš„...", concluido: false },
                    { id: "l2c16g4", texto: "Verbos para esportes (è¸¢, æ‰“, æ¸¸æ³³, è·‘æ­¥)", concluido: false }
                  ],
                  exercicios: [
                    { id: "l2c16e1", texto: "ExercÃ­cio: Descrever aÃ§Ãµes em progresso", concluido: false },
                    { id: "l2c16e2", texto: "ExercÃ­cio: Leitura e interpretaÃ§Ã£o (esportes)", concluido: false },
                    { id: "l2c16e3", texto: "ExercÃ­cio: Reescrever frases na negativa (presente contÃ­nuo)", concluido: false }
                  ],
                  hanzi: [
                    { id: "l2c16h1", texto: "PrÃ¡tica de Hanzi: åœ¨, å‘¢, åŠ , æ²¹, æ‰‹, æœº, æ“, åœº, è¿, åŠ¨, é”», ç‚¼, è¸¢, è¶³, çƒ, æ‰“, ç¯®, ä¸‹, æ¬¡, ä¸Š, å•Š, æ¯”, èµ›, ä½“, è‚², é¦†, å–œ, æ¬¢, æœ‰, çš„, æ¸¸, æ³³, ç©¿, è¡£, æœ", concluido: false }
                  ]
                }
              }
            ]
          }
        ]; // Fim da checklistData

        // --- Estado do Aplicativo ---
        let currentData = [];
        let currentView = 'main';
        let currentChapter = { livroIndex: -1, capituloIndex: -1 };

        // --- Elementos DOM ---
        const appDiv = document.getElementById('app');
        const mainScreen = document.getElementById('main-screen');
        const chapterScreen = document.getElementById('chapter-screen');
        const booksListDiv = document.getElementById('books-list');
        const chapterContentDiv = document.getElementById('chapter-content');
        const backButton = document.getElementById('back-button');
        const chapterTitleH1 = document.getElementById('chapter-title');
        const progressBarTotal = document.getElementById('progress-bar-total');
        const progressTextTotal = document.getElementById('progress-text-total');
        const progressBarChapterDetail = document.getElementById('progress-bar-chapter-detail');
        const progressTextChapterDetail = document.getElementById('progress-text-chapter-detail');
        
        // --- Elementos do PDF Viewer e AnotaÃ§Ãµes ---
        const showPdfButton = document.getElementById('show-pdf-button');
        const hidePdfButton = document.getElementById('hide-pdf-button');
        const toggleAnnotationsButton = document.getElementById('toggle-annotations-button');
        const pdfCanvas = document.getElementById('pdf-canvas');
        const pdfLoading = document.getElementById('pdf-loading');
        const chapterAnnotationsTextarea = document.getElementById('chapter-annotations');
        
        // --- Elementos do Layout Principal ---
        const bookSelector = document.getElementById('book-selector');
        const mainPdfCanvas = document.getElementById('main-pdf-canvas');
        const mainPdfLoading = document.getElementById('main-pdf-loading');
        const mainPdfInfo = document.getElementById('main-pdf-info');
        const pageInfoMain = document.getElementById('page-info-main');
        const prevPageMainButton = document.getElementById('prev-page-main');
        const nextPageMainButton = document.getElementById('next-page-main');
        
        // --- Elementos do Layout Dividido ---
        const splitLayout = document.getElementById('split-layout');
        const traditionalLayout = document.getElementById('traditional-layout');
        const chapterContentSplit = document.getElementById('chapter-content-split');
        const pdfChapterInfo = document.getElementById('pdf-chapter-info');
        const pageInfo = document.getElementById('page-info');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');
        
        // --- VariÃ¡veis de controle do PDF ---
        let currentPage = 1;
        let startPage = 1;
        let endPage = 1;
        let pdfDoc = null;
        let scale = 1.5;
        
        // --- VariÃ¡veis do PDF Principal ---
        let mainPdfDoc = null;
        let mainCurrentPage = 1;
        let mainTotalPages = 0;
        
        // FunÃ§Ãµes do PDF principal na tela dividida
        async function loadMainPdf() {
            console.log('=== INICIANDO loadMainPdf ===');
            console.log('mainPdfCanvas:', mainPdfCanvas);
            console.log('mainPdfLoading:', mainPdfLoading);
            console.log('mainPdfInfo:', mainPdfInfo);
            
            if (!mainPdfCanvas) {
                console.error('âŒ mainPdfCanvas nÃ£o encontrado!');
                return;
            }
            
            if (!mainPdfLoading) {
                console.error('âŒ mainPdfLoading nÃ£o encontrado!');
                return;
            }
            
            try {
                if (mainPdfLoading) {
                    mainPdfLoading.classList.remove('hidden');
                    mainPdfLoading.textContent = 'ğŸ“„ Carregando PDF principal...';
                }
                
                // Carregar Livro 1 como padrÃ£o
                const pdfUrl = 'Livro 1 - IrmÃ£os Mandarim.pdf';
                console.log('Tentando carregar:', pdfUrl);
                
                const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
                mainPdfDoc = pdf;
                mainTotalPages = pdf.numPages;
                mainCurrentPage = 1;
                
                console.log(`âœ… PDF principal carregado: ${mainTotalPages} pÃ¡ginas`);
                await renderMainPdfPage();
                updateMainPdfInfo();
                
                mainPdfLoading.classList.add('hidden');
            } catch (error) {
                console.error('âŒ Erro ao carregar PDF principal:', error);
                if (mainPdfLoading) {
                    mainPdfLoading.innerHTML = '<span class="text-red-500">âŒ Erro ao carregar PDF: ' + error.message + '</span>';
                    mainPdfLoading.classList.remove('hidden');
                }
            }
        }
        
        async function renderMainPdfPage() {
            if (!mainPdfDoc) return;
            
            try {
                const page = await mainPdfDoc.getPage(mainCurrentPage);
                const scale = 1.0;
                const viewport = page.getViewport({ scale });
                
                const context = mainPdfCanvas.getContext('2d');
                mainPdfCanvas.height = viewport.height;
                mainPdfCanvas.width = viewport.width;
                
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                
                // Sincronizar com capÃ­tulos
                syncChapterHighlight();
                
                // Atualizar info da pÃ¡gina
                updateMainPageInfo();
                
            } catch (error) {
                console.error('Erro ao renderizar pÃ¡gina do PDF principal:', error);
            }
        }
        
        function syncChapterHighlight() {
            // Remove highlight anterior
            document.querySelectorAll('.chapter-item.highlighted').forEach(item => {
                item.classList.remove('highlighted', 'bg-blue-50', 'border-blue-200');
            });
            
            // Expande livros se necessÃ¡rio
            document.querySelectorAll('.collapsed').forEach(book => {
                book.classList.remove('collapsed');
                const bookIndex = book.id.match(/book-(\d+)/)?.[1];
                if (bookIndex) {
                    const chaptersList = document.getElementById(`chapters-list-${bookIndex}`);
                    if (chaptersList) {
                        chaptersList.classList.remove('hidden');
                        localStorage.setItem(`book-${bookIndex}-expanded`, 'true');
                    }
                }
            });
            
            // Encontrar capÃ­tulo correspondente Ã  pÃ¡gina atual
            const currentChapterInfo = findChapterByPage(mainCurrentPage);
            if (currentChapterInfo) {
                const { livroIndex, capituloIndex } = currentChapterInfo;
                
                // Destacar capÃ­tulo atual
                const chapterItems = document.querySelectorAll(`.chapter-item`);
                chapterItems.forEach(item => {
                    const onclickAttr = item.querySelector('[onclick]')?.getAttribute('onclick');
                    if (onclickAttr && onclickAttr.includes(`${livroIndex}, ${capituloIndex}`)) {
                        item.classList.add('highlighted', 'bg-blue-50', 'border-blue-200');
                        item.style.borderLeft = '4px solid #3B82F6';
                        
                        // Scroll para o item se necessÃ¡rio
                        item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                });
                
                // Atualizar info do PDF
                const capitulo = currentData[livroIndex].capitulos[capituloIndex];
                mainPdfInfo.textContent = `Livro ${livroIndex + 1} - Cap ${capitulo.capitulo}: ${capitulo.tituloCapitulo}`;
            } else {
                mainPdfInfo.textContent = `PÃ¡gina ${mainCurrentPage} de ${mainTotalPages}`;
            }
        }
        
        function findChapterByPage(pageNumber) {
            // Procurar em ambos os livros qual capÃ­tulo corresponde Ã  pÃ¡gina
            for (let livroIndex = 0; livroIndex < currentData.length; livroIndex++) {
                const pageMapping = chapterPageMapping[livroIndex];
                if (!pageMapping) continue;
                
                for (let capituloIndex = 0; capituloIndex < currentData[livroIndex].capitulos.length; capituloIndex++) {
                    const capitulo = currentData[livroIndex].capitulos[capituloIndex];
                    const capituloNumber = capitulo.capitulo;
                    const chapterPages = pageMapping[capituloNumber];
                    
                    if (chapterPages && pageNumber >= chapterPages.startPage && pageNumber <= chapterPages.endPage) {
                        return { livroIndex, capituloIndex, capituloNumber };
                    }
                }
            }
            return null;
        }
        
        function updateMainPdfInfo() {
            if (!mainPdfDoc) return;
            syncChapterHighlight();
        }
        
        // NavegaÃ§Ã£o do PDF principal
        function goToMainPreviousPage() {
            if (mainCurrentPage > 1) {
                mainCurrentPage--;
                renderMainPdfPage();
            }
        }
        
        function goToMainNextPage() {
            if (mainCurrentPage < mainTotalPages) {
                mainCurrentPage++;
                renderMainPdfPage();
            }
        }
        
        // FunÃ§Ã£o para trocar de livro
        async function switchToBook(bookIndex) {
            try {
                mainPdfLoading.classList.remove('hidden');
                
                const pdfUrl = `Livro ${bookIndex + 1} - IrmÃ£os Mandarim.pdf`;
                const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
                mainPdfDoc = pdf;
                mainTotalPages = pdf.numPages;
                mainCurrentPage = 1;
                
                console.log(`Livro ${bookIndex + 1} carregado: ${mainTotalPages} pÃ¡ginas`);
                await renderMainPdfPage();
                updateMainPageInfo();
                
                mainPdfLoading.classList.add('hidden');
            } catch (error) {
                console.error('Erro ao carregar livro:', error);
                mainPdfLoading.innerHTML = '<span class="text-red-500">âŒ Erro ao carregar livro</span>';
            }
        }
        
        function updateMainPageInfo() {
            if (pageInfoMain) {
                pageInfoMain.textContent = `${mainCurrentPage}/${mainTotalPages}`;
            }
            updateMainPdfInfo();
        }
        
        // Adicionar event listeners para teclado
        document.addEventListener('keydown', (e) => {
            if (currentView === 'main') {
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    goToMainPreviousPage();
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    goToMainNextPage();
                }
            }
        });

        // --- FunÃ§Ãµes do Checklist COMPLETAS ---
         function calculateSubtopicProgress(subtopicosObj) {
            let total = 0; let completed = 0;
            for (const key in subtopicosObj) { if (Array.isArray(subtopicosObj[key])) { subtopicosObj[key].forEach(item => { if (item.hasOwnProperty('concluido')) { total++; if (item.concluido) completed++; } }); } }
            return total === 0 ? 0 : Math.round((completed / total) * 100);
        }
        function calculateAllProgress() {
            let totalItems = 0; 
            let completedItems = 0; 
            const bookProgress = []; 
            const chapterProgress = [];
            
            currentData.forEach((livro, livroIndex) => { 
                let livroTotal = 0; 
                let livroCompleted = 0; 
                
                livro.capitulos.forEach((cap, capIndex) => { 
                    let capTotal = 0; 
                    let capCompleted = 0; 
                    
                    for (const key in cap.subtopicos) { 
                        if (Array.isArray(cap.subtopicos[key])) { 
                            cap.subtopicos[key].forEach(item => { 
                                if (item.hasOwnProperty('concluido')) { 
                                    capTotal++; 
                                    if (item.concluido) capCompleted++; 
                                } 
                            }); 
                        } 
                    } 
                    
                    livroTotal += capTotal; 
                    livroCompleted += capCompleted; 
                    totalItems += capTotal; 
                    completedItems += capCompleted; 
                    
                    const progress = capTotal === 0 ? 0 : Math.round((capCompleted / capTotal) * 100); 
                    chapterProgress.push({ livro: livroIndex, capitulo: capIndex, progress: progress }); 
                }); 
                
                const progress = livroTotal === 0 ? 0 : Math.round((livroCompleted / livroTotal) * 100); 
                bookProgress.push(progress); 
                
                console.log(`Livro ${livroIndex + 1}: ${livroCompleted}/${livroTotal} itens (${progress}%)`);
            });
            
            const totalProgress = totalItems === 0 ? 0 : Math.round((completedItems / totalItems) * 100); 
            console.log(`PROGRESSO TOTAL: ${completedItems}/${totalItems} itens (${totalProgress}%)`);
            console.log('Progresso por livro:', bookProgress);
            
            return { totalProgress, bookProgress, chapterProgress, totalItems, completedItems };
        }
        function updateProgressDisplay() {
            const { totalProgress, bookProgress, chapterProgress } = calculateAllProgress();
            progressBarTotal.style.width = `${totalProgress}%`; progressBarTotal.textContent = totalProgress > 10 ? `${totalProgress}%` : ''; progressTextTotal.textContent = `${totalProgress}%`;
            currentData.forEach((livro, index) => { const bar = document.getElementById(`progress-bar-book-${index}`); const text = document.getElementById(`progress-text-book-${index}`); if(bar && text) { const progress = bookProgress[index]; bar.style.width = `${progress}%`; bar.textContent = progress > 10 ? `${progress}%` : ''; text.textContent = `${progress}%`; } });
             chapterProgress.forEach(cp => { const bar = document.getElementById(`progress-bar-chapter-${cp.livro}-${cp.capitulo}`); const text = document.getElementById(`progress-text-chapter-${cp.livro}-${cp.capitulo}`); if (bar && text) { bar.style.width = `${cp.progress}%`; text.textContent = `${cp.progress}%`; } });
            if (currentView === 'chapter' && currentChapter.livroIndex !== -1 && currentChapter.capituloIndex !== -1 && currentData[currentChapter.livroIndex] && currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex]) { // Checagem extra
                const currentCapProgress = chapterProgress.find(cp => cp.livro === currentChapter.livroIndex && cp.capitulo === currentChapter.capituloIndex)?.progress || 0;
                 progressBarChapterDetail.style.width = `${currentCapProgress}%`; progressBarChapterDetail.textContent = currentCapProgress > 10 ? `${currentCapProgress}%` : ''; progressTextChapterDetail.textContent = `${currentCapProgress}%`;
                 const capitulo = currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex];
                 const titleElement = document.getElementById('chapter-title');
                 if (titleElement) titleElement.textContent = `Livro ${currentChapter.livroIndex + 1} - Cap ${capitulo.capitulo}: ${capitulo.tituloCapitulo}`;
            }
        }
       function renderMainScreen() {
            console.log('Renderizando tela principal...', currentData);
            
            // Remove o status de carregamento
            const loadingStatus = document.getElementById('loading-status');
            if (loadingStatus) {
                loadingStatus.style.display = 'none';
            }
            
            booksListDiv.innerHTML = ''; // Limpa antes de renderizar
            
            if (!currentData || currentData.length === 0) {
                console.error('currentData estÃ¡ vazio ou invÃ¡lido');
                booksListDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        <h3 class="font-bold">âŒ Erro: Dados nÃ£o carregaram</h3>
                        <p>currentData estÃ¡ vazio. Verifique o console para mais detalhes.</p>
                        <button onclick="location.reload()" class="mt-2 bg-red-500 text-white px-3 py-1 rounded text-sm">
                            Recarregar PÃ¡gina
                        </button>
                    </div>
                `;
                return;
            }
            
            currentData.forEach((livro, livroIndex) => {
                console.log(`Renderizando livro ${livroIndex}:`, livro);
                const isBookExpanded = localStorage.getItem(`book-${livroIndex}-expanded`) !== 'false';
                console.log(`Livro ${livroIndex} expandido:`, isBookExpanded);
                
                const bookDiv = document.createElement('div'); 
                bookDiv.className = `bg-white rounded-lg shadow border border-gray-200 ${isBookExpanded ? '' : 'collapsed'}`; 
                bookDiv.id = `book-${livroIndex}`;
                
                const bookHeader = document.createElement('div'); 
                bookHeader.className = 'p-4 cursor-pointer flex justify-between items-center'; 
                bookHeader.onclick = () => toggleBook(livroIndex);
                
                const bookTitle = document.createElement('h2'); 
                bookTitle.className = 'text-lg md:text-xl font-semibold text-gray-700 flex items-center'; 
                bookTitle.innerHTML = `<span class="toggle-icon mr-2"></span> ${livro.tituloLivro}`; 
                bookHeader.appendChild(bookTitle);
                
                const bookProgressDiv = document.createElement('div'); 
                bookProgressDiv.className = 'w-1/3 md:w-1/4 ml-4'; 
                bookProgressDiv.innerHTML = `<div class="progress-bar-bg"><div id="progress-bar-book-${livroIndex}" class="progress-bar-fill"></div></div><p id="progress-text-book-${livroIndex}" class="text-right text-xs font-medium text-gray-600 mt-1">0%</p>`; 
                bookHeader.appendChild(bookProgressDiv); 
                bookDiv.appendChild(bookHeader);
                
                const chaptersList = document.createElement('ul'); 
                chaptersList.className = `border-t border-gray-200 ${isBookExpanded ? '' : 'hidden'}`; 
                chaptersList.id = `chapters-list-${livroIndex}`;
                
                if(livro.capitulos && Array.isArray(livro.capitulos)) {
                    console.log(`Livro ${livroIndex} tem ${livro.capitulos.length} capÃ­tulos`);
                    livro.capitulos.forEach((cap, capIndex) => {
                        const li = document.createElement('li'); 
                        li.className = 'border-b border-gray-100 last:border-b-0 chapter-item cursor-pointer transition duration-150 ease-in-out';
                        li.innerHTML = `<div class="p-3 px-4 flex justify-between items-center" onclick="showChapterDetail(${livroIndex}, ${capIndex})"><span class="text-gray-700">Cap ${cap.capitulo}: ${cap.tituloCapitulo}</span><div class="w-1/4 md:w-1/5 ml-2 text-right"><div class="progress-bar-bg !h-3"><div id="progress-bar-chapter-${livroIndex}-${capIndex}" class="progress-bar-fill !text-transparent"></div></div><p id="progress-text-chapter-${livroIndex}-${capIndex}" class="text-xs font-medium text-gray-500">0%</p></div></div>`; 
                        chaptersList.appendChild(li);
                    });
                } else {
                    console.error(`Livro ${livroIndex} nÃ£o tem capÃ­tulos vÃ¡lidos:`, livro.capitulos);
                }
                
                bookDiv.appendChild(chaptersList); 
                booksListDiv.appendChild(bookDiv);
            });
            
            updateProgressDisplay();
            
            // Adiciona informaÃ§Ã£o de sucesso
            const successDiv = document.createElement('div');
            successDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mt-4';
            successDiv.innerHTML = `
                <p>âœ… <strong>Dados carregados com sucesso!</strong></p>
                <p class="text-sm">Renderizados ${currentData.length} livros com ${currentData.reduce((total, livro) => total + (livro.capitulos?.length || 0), 0)} capÃ­tulos.</p>
            `;
            booksListDiv.appendChild(successDiv);
            
            console.log(`RenderizaÃ§Ã£o concluÃ­da: ${currentData.length} livros, ${currentData.reduce((total, livro) => total + (livro.capitulos?.length || 0), 0)} capÃ­tulos`);
        }
        function renderChapterDetail(livroIndex, capituloIndex) {
             if (!currentData[livroIndex] || !currentData[livroIndex].capitulos[capituloIndex]) {
                 console.error("Dados invÃ¡lidos para renderChapterDetail:", livroIndex, capituloIndex);
                 showMainScreen(); // Volta para tela principal se dados invÃ¡lidos
                 return;
             }
            const capitulo = currentData[livroIndex].capitulos[capituloIndex]; currentChapter = { livroIndex, capituloIndex }; chapterContentDiv.innerHTML = ''; // Limpa antes de renderizar
            const subtopicSections = [{ title: 'TÃ“PICOS', key: 'topicos'}, { title: 'DIÃLOGOS', key: 'dialogos' },{ title: 'VOCABULÃRIO', key: 'vocabulario' }, { title: 'GRAMÃTICA E ESTRUTURAS', key: 'gramatica' }, { title: 'TEXTO(S)', key: 'textos' }, { title: 'APRESENTAÃ‡ÃƒO(Ã•ES)', key: 'apresentacoes' }, { title: 'EXERCÃCIOS', key: 'exercicios' }, { title: 'CARACTERES (HANZI)', key: 'hanzi' }];
             subtopicSections.forEach(section => { const items = capitulo.subtopicos[section.key]; if (items && Array.isArray(items) && items.length > 0) { const sectionDiv = document.createElement('div'); const sectionTitle = document.createElement('h3'); sectionTitle.className = 'text-md font-semibold mb-2 text-gray-600 border-b pb-1'; sectionTitle.textContent = section.title; sectionDiv.appendChild(sectionTitle); const ul = document.createElement('ul'); ul.className = 'space-y-1'; items.forEach(item => { const li = document.createElement('li'); li.className = `flex items-center text-sm ${item.concluido ? 'completed-item' : ''}`; li.innerHTML = `<input type="checkbox" id="${item.id}" data-livro="${livroIndex}" data-capitulo="${capituloIndex}" data-key="${section.key}" data-itemid="${item.id}" ${item.concluido ? 'checked' : ''} class="mr-2 h-4 w-4 rounded border-gray-300 text-emerald-500 focus:ring-emerald-400 cursor-pointer"><label for="${item.id}" class="text-gray-700 cursor-pointer">${item.texto}</label>`; const checkbox = li.querySelector('input[type="checkbox"]'); if(checkbox) { checkbox.addEventListener('change', handleCheckboxChange); } ul.appendChild(li); }); sectionDiv.appendChild(ul); chapterContentDiv.appendChild(sectionDiv); } });
            updateProgressDisplay(); // Atualiza a barra de progresso do capÃ­tulo

            // --- INÃCIO DA ADIÃ‡ÃƒO: SeÃ§Ã£o de Notas ---
            const notesSection = document.createElement('div');
            notesSection.className = 'mt-6 pt-4 border-t border-gray-200'; // Margem e separador
            
            const notesTitle = document.createElement('h3');
            notesTitle.className = 'text-md font-semibold mb-2 text-gray-600';
            notesTitle.textContent = 'NOTAS DO CAPÃTULO';
            notesSection.appendChild(notesTitle);
            
            const notesTextarea = document.createElement('textarea');
            const notesKey = `mandarinNotes-l${livroIndex}c${capituloIndex}`; // Chave Ãºnica para localStorage
            
            notesTextarea.id = `notes-${livroIndex}-${capituloIndex}`;
            notesTextarea.className = 'notes-textarea';
            notesTextarea.placeholder = 'Digite seus comentÃ¡rios, dÃºvidas ou notas sobre este capÃ­tulo...';
            
            // Carrega as notas salvas do localStorage
            notesTextarea.value = localStorage.getItem(notesKey) || '';
            
            // Salva as notas automaticamente ao digitar (com um pequeno atraso para eficiÃªncia)
            let debounceTimer;
            notesTextarea.addEventListener('keyup', () => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    localStorage.setItem(notesKey, notesTextarea.value);
                }, 300); // Salva 300ms apÃ³s o usuÃ¡rio parar de digitar
            });
            
            notesSection.appendChild(notesTextarea);
            chapterContentDiv.appendChild(notesSection);
            // --- FIM DA ADIÃ‡ÃƒO ---
        }
       function showChapterDetail(livroIndex, capituloIndex) { currentView = 'chapter'; mainScreen.classList.add('hidden'); chapterScreen.classList.remove('hidden'); renderChapterDetail(livroIndex, capituloIndex); window.scrollTo(0, 0); }
       function showMainScreen() { currentView = 'main'; chapterScreen.classList.add('hidden'); mainScreen.classList.remove('hidden'); currentChapter = { livroIndex: -1, capituloIndex: -1 }; renderMainScreen(); } // Renderiza main screen ao voltar
       function handleCheckboxChange(event) {
            const checkbox = event.target; const livroIndex = parseInt(checkbox.dataset.livro); const capIndex = parseInt(checkbox.dataset.capitulo); const key = checkbox.dataset.key; const itemId = checkbox.dataset.itemid; const isChecked = checkbox.checked;
            try { const item = currentData[livroIndex].capitulos[capIndex].subtopicos[key].find(i => i.id === itemId); if (item) { item.concluido = isChecked; checkbox.closest('li').classList.toggle('completed-item', isChecked); saveProgress(); updateProgressDisplay(); } else { console.error("Item not found:", itemId, "in", key); } } catch (e) { console.error("Error updating item state:", e, {livroIndex, capIndex, key, itemId}); }
        }
       function toggleBook(livroIndex) { const bookDiv = document.getElementById(`book-${livroIndex}`); const chaptersList = document.getElementById(`chapters-list-${livroIndex}`); if(bookDiv && chaptersList) { const isCollapsed = bookDiv.classList.toggle('collapsed'); chaptersList.classList.toggle('hidden'); localStorage.setItem(`book-${livroIndex}-expanded`, !isCollapsed); } else { console.error("Could not find book elements for toggling:", livroIndex); } }
       function saveProgress() { try { localStorage.setItem('mandarinProgressData', JSON.stringify(currentData)); } catch (e) { console.error("Erro ao salvar progresso:", e); alert("Erro ao salvar progresso. Pode ser que o armazenamento local esteja cheio.");} } // Adiciona alerta
        function loadProgress() {
            const savedData = localStorage.getItem('mandarinProgressData'); let dataToUse = checklistData; // Usa checklistData como padrÃ£o
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    // ValidaÃ§Ã£o bÃ¡sica da estrutura salva
                    if (Array.isArray(parsedData) && parsedData.length === checklistData.length &&
                        parsedData.every(book => book && Array.isArray(book.capitulos)))
                    {
                        // Merge profundo para preservar estrutura e IDs originais, atualizando apenas 'concluido'
                        dataToUse = checklistData.map((bookDefault, bookIndex) => ({
                            ...bookDefault,
                            capitulos: bookDefault.capitulos.map((chapterDefault, chapterIndex) => {
                                const savedChapter = parsedData[bookIndex]?.capitulos[chapterIndex];
                                const mergedSubtopicos = {};
                                for (const key in chapterDefault.subtopicos) {
                                    if (Array.isArray(chapterDefault.subtopicos[key])) {
                                        mergedSubtopicos[key] = chapterDefault.subtopicos[key].map(itemDefault => {
                                            const savedItem = savedChapter?.subtopicos?.[key]?.find(i => i.id === itemDefault.id);
                                            // Garante que 'concluido' seja boolean
                                            const concluidoState = savedItem ? !!savedItem.concluido : false;
                                            return { ...itemDefault, concluido: concluidoState };
                                        });
                                    }
                                }
                                return { ...chapterDefault, subtopicos: mergedSubtopicos };
                            })
                        }));
                        console.log("Progresso carregado do LocalStorage.");
                    } else {
                        console.warn("Estrutura salva invÃ¡lida ou incompatÃ­vel. Usando dados padrÃ£o.");
                        localStorage.removeItem('mandarinProgressData'); // Limpa dados invÃ¡lidos
                        dataToUse = checklistData; // Garante que estÃ¡ usando o padrÃ£o
                    }
                } catch (e) {
                    console.error("Erro ao carregar/parsear progresso:", e);
                    localStorage.removeItem('mandarinProgressData'); // Limpa dados corrompidos
                    dataToUse = checklistData; // Garante que estÃ¡ usando o padrÃ£o
                }
            } else {
                console.log("Nenhum progresso salvo encontrado. Usando dados padrÃ£o.");
                dataToUse = checklistData; // Garante que estÃ¡ usando o padrÃ£o
            }
             // Cria uma cÃ³pia profunda para evitar mutaÃ§Ãµes inesperadas no objeto original
            currentData = JSON.parse(JSON.stringify(dataToUse));
        }
        // --- FIM DAS FUNÃ‡Ã•ES DO CHECKLIST ---

        // --- ConfiguraÃ§Ã£o do PDF.js ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';

        // --- FunÃ§Ãµes do PDF Viewer e AnotaÃ§Ãµes ---
        async function showPdfViewer() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            // Obter informaÃ§Ãµes do capÃ­tulo
            const livroNumber = currentChapter.livroIndex + 1;
            const capitulo = currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex];
            const capituloNumber = capitulo.capitulo;
            const pageMapping = chapterPageMapping[currentChapter.livroIndex];
            
            console.log(`Debug: livroIndex=${currentChapter.livroIndex}, capituloIndex=${currentChapter.capituloIndex}, capituloNumber=${capituloNumber}`);
            
            if (!pageMapping || !pageMapping[capituloNumber]) {
                alert(`Mapeamento de pÃ¡ginas nÃ£o encontrado para Livro ${livroNumber}, CapÃ­tulo ${capituloNumber}.`);
                return;
            }
            
            // Configurar pÃ¡ginas do capÃ­tulo
            const chapterPages = pageMapping[capituloNumber];
            startPage = chapterPages.startPage;
            endPage = chapterPages.endPage;
            currentPage = startPage;
            
            // Configurar interface
            pdfChapterInfo.textContent = `${capitulo.tituloCapitulo} (PÃ¡ginas ${startPage}-${endPage})`;
            
            // Carregar PDF
            const pdfFileName = `Livro ${livroNumber} - IrmÃ£os Mandarim.pdf`;
            await loadPdf(pdfFileName);
            
            // Renderizar checklist no layout dividido
            renderChapterContentSplit();
            
            // Carregar anotaÃ§Ãµes
            loadChapterAnnotations();
            
            // Mostrar layout dividido
            traditionalLayout.classList.add('hidden');
            splitLayout.classList.remove('hidden');
            showPdfButton.classList.add('hidden');
            hidePdfButton.classList.remove('hidden');
            
            console.log(`Abrindo PDF: ${pdfFileName}, PÃ¡ginas: ${startPage}-${endPage}`);
        }
        
        async function loadPdf(pdfUrl) {
            try {
                pdfLoading.classList.remove('hidden');
                console.log('Carregando PDF:', pdfUrl);
                
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                pdfDoc = await loadingTask.promise;
                
                console.log(`PDF carregado. Total de pÃ¡ginas: ${pdfDoc.numPages}`);
                
                // Validar se as pÃ¡ginas do capÃ­tulo existem no PDF
                if (startPage > pdfDoc.numPages) {
                    console.error(`PÃ¡gina inicial ${startPage} nÃ£o existe no PDF (total: ${pdfDoc.numPages})`);
                    alert(`Erro: PÃ¡gina ${startPage} nÃ£o encontrada no PDF. O arquivo pode estar incompleto.`);
                    return;
                }
                
                // Ajustar endPage se for maior que o total de pÃ¡ginas
                if (endPage > pdfDoc.numPages) {
                    console.warn(`PÃ¡gina final ${endPage} ajustada para ${pdfDoc.numPages}`);
                    endPage = pdfDoc.numPages;
                }
                
                // Renderizar primeira pÃ¡gina do capÃ­tulo
                await renderPage(currentPage);
                
                pdfLoading.classList.add('hidden');
            } catch (error) {
                console.error('Erro ao carregar PDF:', error);
                pdfLoading.textContent = 'Erro ao carregar PDF';
                alert('Erro ao carregar o PDF. Verifique se o arquivo existe.');
            }
        }
        
        async function renderPage(pageNum) {
            try {
                console.log(`Renderizando pÃ¡gina ${pageNum}`);
                pdfLoading.classList.remove('hidden');
                
                const page = await pdfDoc.getPage(pageNum);
                const viewport = page.getViewport({ scale: scale });
                
                // Configurar canvas
                const context = pdfCanvas.getContext('2d');
                pdfCanvas.height = viewport.height;
                pdfCanvas.width = viewport.width;
                
                // Renderizar pÃ¡gina
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                
                // Atualizar controles
                updatePageControls();
                
                pdfLoading.classList.add('hidden');
                console.log(`PÃ¡gina ${pageNum} renderizada`);
                
            } catch (error) {
                console.error('Erro ao renderizar pÃ¡gina:', error);
                pdfLoading.textContent = 'Erro ao renderizar pÃ¡gina';
            }
        }
        
        function updatePageControls() {
            // Calcular pÃ¡gina relativa ao capÃ­tulo (1, 2, 3...)
            const relativePageNum = currentPage - startPage + 1;
            const totalChapterPages = endPage - startPage + 1;
            
            pageInfo.textContent = `${relativePageNum}/${totalChapterPages}`;
            
            // Controlar botÃµes
            prevPageButton.disabled = currentPage <= startPage;
            nextPageButton.disabled = currentPage >= endPage;
            
            prevPageButton.classList.toggle('opacity-50', currentPage <= startPage);
            nextPageButton.classList.toggle('opacity-50', currentPage >= endPage);
        }
        
        function hidePdfViewer() {
            // Esconder layout dividido
            splitLayout.classList.add('hidden');
            traditionalLayout.classList.remove('hidden');
            hidePdfButton.classList.add('hidden');
            showPdfButton.classList.remove('hidden');
            
            // Limpar PDF
            if (pdfCanvas) {
                const context = pdfCanvas.getContext('2d');
                context.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
            }
            pdfDoc = null;
            
            console.log('PDF fechado');
        }
        
        async function prevPage() {
            if (currentPage > startPage) {
                currentPage--;
                await renderPage(currentPage);
            }
        }
        
        async function nextPage() {
            if (currentPage < endPage) {
                currentPage++;
                await renderPage(currentPage);
            }
        }
        
        function renderChapterContentSplit() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            console.log('Renderizando checklist dividido...');
            
            const capitulo = currentData[currentChapter.livroIndex].capitulos[currentChapter.capituloIndex];
            
            // Verifica se o elemento principal existe
            if (!chapterContentSplit) {
                console.error('chapterContentSplit nÃ£o encontrado');
                return;
            }
            
            // Procura pelo div de conteÃºdo
            let contentDiv = chapterContentSplit.querySelector('.p-2.space-y-2');
            
            if (!contentDiv) {
                console.log('Div de conteÃºdo nÃ£o encontrado, tentando criar...');
                // Se nÃ£o encontrou, tenta o div pai e procura estrutura alternativa
                const parentDiv = chapterContentSplit.querySelector('div');
                if (parentDiv && parentDiv.children.length > 1) {
                    contentDiv = parentDiv.children[1]; // O segundo div deve ser o conteÃºdo
                }
            }
            
            if (!contentDiv) {
                console.error('NÃ£o foi possÃ­vel encontrar ou criar div de conteÃºdo');
                return;
            }
            
            contentDiv.innerHTML = '';
            console.log('Limpou conteÃºdo, iniciando renderizaÃ§Ã£o...');
            
            const subtopicSections = [
                { title: 'TÃ“PICOS', key: 'topicos'},
                { title: 'DIÃLOGOS', key: 'dialogos' },
                { title: 'VOCABULÃRIO', key: 'vocabulario' }, 
                { title: 'GRAMÃTICA', key: 'gramatica' }, 
                { title: 'EXERCÃCIOS', key: 'exercicios' }, 
                { title: 'HANZI', key: 'hanzi' }
            ];
            
            subtopicSections.forEach(section => { 
                const items = capitulo.subtopicos[section.key]; 
                if (items && Array.isArray(items) && items.length > 0) { 
                    const sectionDiv = document.createElement('div'); 
                    const sectionTitle = document.createElement('h4'); 
                    sectionTitle.className = 'text-sm font-semibold mb-1 text-gray-600 border-b pb-1'; 
                    sectionTitle.textContent = section.title; 
                    sectionDiv.appendChild(sectionTitle); 
                    
                    const ul = document.createElement('ul'); 
                    ul.className = 'space-y-1'; 
                    items.forEach(item => { 
                        const li = document.createElement('li'); 
                        li.className = `flex items-start text-xs ${item.concluido ? 'completed-item' : ''}`; 
                        li.innerHTML = `
                            <input type="checkbox" id="${item.id}-split" data-livro="${currentChapter.livroIndex}" data-capitulo="${currentChapter.capituloIndex}" data-key="${section.key}" data-itemid="${item.id}" ${item.concluido ? 'checked' : ''} class="mr-2 mt-0.5 h-3 w-3 rounded border-gray-300 text-emerald-500 focus:ring-emerald-400 cursor-pointer">
                            <label for="${item.id}-split" class="text-gray-700 cursor-pointer leading-tight">${item.texto}</label>
                        `; 
                        const checkbox = li.querySelector('input[type="checkbox"]'); 
                        if(checkbox) { 
                            checkbox.addEventListener('change', handleCheckboxChange); 
                        } 
                        ul.appendChild(li); 
                    }); 
                    sectionDiv.appendChild(ul); 
                    contentDiv.appendChild(sectionDiv); 
                } 
            });
        }
        
        function loadChapterAnnotations() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            const annotationsKey = `mandarinAnnotations-l${currentChapter.livroIndex}c${currentChapter.capituloIndex}`;
            const savedAnnotations = localStorage.getItem(annotationsKey) || '';
            
            chapterAnnotationsTextarea.value = savedAnnotations;
            console.log(`Carregadas anotaÃ§Ãµes para L${currentChapter.livroIndex + 1}C${currentChapter.capituloIndex}: ${savedAnnotations.length} caracteres`);
        }
        
        function saveChapterAnnotations() {
            if (currentChapter.livroIndex === -1 || currentChapter.capituloIndex === -1) return;
            
            const annotationsKey = `mandarinAnnotations-l${currentChapter.livroIndex}c${currentChapter.capituloIndex}`;
            const annotations = chapterAnnotationsTextarea.value;
            
            localStorage.setItem(annotationsKey, annotations);
            console.log(`Salvas anotaÃ§Ãµes para L${currentChapter.livroIndex + 1}C${currentChapter.capituloIndex}: ${annotations.length} caracteres`);
        }

        // --- FunÃ§Ã£o para resetar dados ---
        function resetData() {
            if (confirm('Tem certeza que deseja resetar todos os dados? Isso apagarÃ¡ todo o progresso salvo.')) {
                // Remove todos os dados do localStorage
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('mandarinProgressData') || 
                        key.startsWith('mandarinNotes-') || 
                        key.startsWith('book-') && key.endsWith('-expanded')) {
                        localStorage.removeItem(key);
                    }
                });
                
                console.log('Dados resetados');
                alert('Dados resetados! A pÃ¡gina serÃ¡ recarregada.');
                location.reload();
            }
        }

        // --- InicializaÃ§Ã£o ---
         function init() {
            console.log('=== INICIANDO APLICATIVO ===');
            console.log('checklistData original:', checklistData);
            console.log('DOM elements check:');
            console.log('- mainPdfCanvas:', document.getElementById('main-pdf-canvas'));
            console.log('- mainPdfLoading:', document.getElementById('main-pdf-loading'));
            console.log('- mainPdfInfo:', document.getElementById('main-pdf-info'));
            
            try {
                loadProgress();
                console.log('currentData apÃ³s loadProgress:', currentData);
                
                if (!currentData || currentData.length === 0) {
                    console.error('ERRO CRÃTICO: currentData estÃ¡ vazio!');
                    alert('Erro: Dados nÃ£o carregaram. Recarregando pÃ¡gina...');
                    location.reload();
                    return;
                }
                
                console.log('ğŸ¯ Antes de renderMainScreen');
                try {
                    renderMainScreen();
                    console.log('ğŸ¯ Depois de renderMainScreen');
                } catch (error) {
                    console.error('âŒ Erro em renderMainScreen:', error);
                    console.log('ğŸ¯ Continuando apesar do erro...');
                }
                
                // Carregar PDF principal apÃ³s renderizaÃ§Ã£o
                console.log('ğŸ¯ Configurando setTimeout para PDF...');
                setTimeout(() => {
                    console.log('ğŸ” Iniciando carregamento do PDF principal...');
                    
                    const mainScreen = document.getElementById('main-screen');
                    const pdfArea = document.querySelector('div.w-1\\/2');
                    const mainPdfCanvas = document.getElementById('main-pdf-canvas');
                    
                    console.log('âœ… main-screen found:', !!mainScreen);
                    console.log('âœ… PDF area found:', !!pdfArea);
                    console.log('âœ… main-pdf-canvas found:', !!mainPdfCanvas);
                    console.log('âœ… main-screen visible:', mainScreen && !mainScreen.classList.contains('hidden'));
                    
                    if (mainPdfCanvas) {
                        console.log('ğŸš€ Chamando loadMainPdf...');
                        loadMainPdf();
                    } else {
                        console.error('âŒ main-pdf-canvas nÃ£o encontrado!');
                    }
                }, 1000);
                
                console.log('=== APLICATIVO INICIADO COM SUCESSO ===');
                
            } catch (error) {
                console.error('ERRO na inicializaÃ§Ã£o:', error);
                alert('Erro crÃ­tico na inicializaÃ§Ã£o: ' + error.message);
            }
            
            if(backButton) { // Checa se backButton existe
                 backButton.addEventListener('click', showMainScreen);
            } else {
                 console.error("Back button not found");
            }
            
            // Event listeners para PDF viewer e anotaÃ§Ãµes
            if(showPdfButton) {
                showPdfButton.addEventListener('click', showPdfViewer);
            }
            
            if(hidePdfButton) {
                hidePdfButton.addEventListener('click', hidePdfViewer);
            }
            
            if(prevPageButton) {
                prevPageButton.addEventListener('click', prevPage);
            }
            
            if(nextPageButton) {
                nextPageButton.addEventListener('click', nextPage);
            }
            
            // Auto-save para anotaÃ§Ãµes
            if(chapterAnnotationsTextarea) {
                let annotationsDebounceTimer;
                chapterAnnotationsTextarea.addEventListener('keyup', () => {
                    clearTimeout(annotationsDebounceTimer);
                    annotationsDebounceTimer = setTimeout(() => {
                        saveChapterAnnotations();
                    }, 300);
                });
            }
            
            // Event listeners para o PDF principal
            if(prevPageMainButton) {
                prevPageMainButton.addEventListener('click', goToMainPreviousPage);
            }
            
            if(nextPageMainButton) {
                nextPageMainButton.addEventListener('click', goToMainNextPage);
            }
            
            if(bookSelector) {
                bookSelector.addEventListener('change', async (e) => {
                    const selectedBookIndex = e.target.value;
                    if (selectedBookIndex !== '') {
                        await switchToBook(parseInt(selectedBookIndex));
                    }
                });
            }
            
        }

        document.addEventListener('DOMContentLoaded', init);

    </script>

    <!-- Script do Chatbase Widget (COLE O SEU AQUI ou logo abaixo) -->
    <script>
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="lQAieVgUdlOSGG5P02Wx_";script.domain="www.chatbase.co";script.defer = true; document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
    </script>

</body>
</html>



